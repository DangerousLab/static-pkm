{"version":3,"file":"app.min.js","sources":["core/state.js","core/utils.js","modules/theme.js","modules/sidebar.js","modules/content-loader.js","modules/search.js","modules/preloader.js","modules/navigation.js","modules/safe-area-detector.js","utilities/mathJax.js","app.js"],"sourcesContent":["/**\n * Central state management for the application\n * All shared state variables and constants\n */\n\nexport const state = {\n  activeInstance: null,\n  activeNode: null,\n  baseSidebarWidth: 240,\n  hoverSidebarWidth: 240,\n  hoverNeeded: false,\n  searchIndex: [],\n  selectedResultIndex: -1,\n  moduleDisplayNames: {},\n  preloadedModules: new Set(),\n  navigationTree: null,\n  currentFolder: null,\n  loadedScripts: new Set(),\n  moduleFactories: new Map(),\n  moduleReadyCallbacks: new Map(),\n  // NEW: Cache computed widths per folder path\n  folderWidthCache: new Map(),\n};\n\nexport const themeController = {\n  getTheme() {\n    return document.documentElement.getAttribute(\"data-theme\") || \"dark\";\n  },\n  subscribe(fn) {\n    document.addEventListener(\"themechange\", fn);\n    return () => document.removeEventListener(\"themechange\", fn);\n  },\n};\n\n// Export DOM references (initialized after DOM is ready)\nexport const dom = {\n  htmlEl: document.documentElement,\n  sidebar: null,\n  sidebarToggle: null,\n  sidebarNav: null,\n  sidebarBreadcrumb: null,\n  card: null,\n  themeToggleBtn: null,\n  themeIcon: null,\n  searchInput: null,\n  searchClear: null,\n  searchResults: null,\n  mainContent: null,\n};\n\n// Initialize DOM references when DOM is ready\nexport function initDOMRefs() {\n  dom.sidebar = document.getElementById(\"sidebar\");\n  dom.sidebarToggle = document.getElementById(\"sidebarToggle\");\n  dom.sidebarNav = document.getElementById(\"sidebarNav\");\n  dom.sidebarBreadcrumb = document.getElementById(\"sidebarBreadcrumb\");\n  dom.card = document.getElementById(\"contentCard\");\n  dom.themeToggleBtn = document.getElementById(\"themeToggle\");\n  dom.themeIcon = document.getElementById(\"themeIcon\");\n  dom.searchInput = document.getElementById(\"searchInput\");\n  dom.searchClear = document.getElementById(\"searchClear\");\n  dom.searchResults = document.getElementById(\"searchResults\");\n  dom.mainContent = document.querySelector(\".main-content\");\n}","/**\n * Utility functions\n * Helper functions used across multiple modules\n */\n\nimport { state } from './state.js';\n\n/**\n * Find a node by its path in the navigation tree\n */\nexport function findNodeByPath(node, path) {\n  if (node.path === path) return node;\n  if (!node.children) return null;\n  for (const child of node.children) {\n    const found = findNodeByPath(child, path);\n    if (found) return found;\n  }\n  return null;\n}\n\n/**\n * Find a leaf node (module/page/document) by its ID\n */\nexport function findLeafById(node, id) {\n  if (!node) return null;\n  if (\n    (node.type === \"module\" ||\n      node.type === \"page\" ||\n      node.type === \"document\") &&\n    node.id === id\n  ) {\n    return node;\n  }\n  if (!node.children) return null;\n  for (const child of node.children) {\n    const found = findLeafById(child, id);\n    if (found) return found;\n  }\n  return null;\n}\n\n/**\n * Find the parent folder of a given node\n */\nexport function findParentFolder(node) {\n  if (!node || !node.path) return state.navigationTree;\n\n  const pathParts = node.path.split(\"/\");\n  if (pathParts.length <= 1) return state.navigationTree;\n\n  const parentPath = pathParts.slice(0, -1).join(\"/\");\n  return findNodeByPath(state.navigationTree, parentPath) || state.navigationTree;\n}\n\n/**\n * Check if viewport is desktop or tablet size\n */\nexport function isDesktopOrTablet() {\n  return window.innerWidth >= 841;\n}\n\n/**\n * Check if viewport is medium size (tablet range)\n */\nexport function isMediumViewport() {\n  return window.innerWidth >= 841 && window.innerWidth <= 1470;\n}\n\n/**\n * Convert file path to URL\n */\nexport function scriptUrlFromFile(filePath) {\n  return \"./\" + filePath;\n}\n\n/**\n * Generate factory function name from module ID\n */\nexport function factoryNameFromId(id) {\n  return \"create\" + id.charAt(0).toUpperCase() + id.slice(1);\n}\n\n/**\n * Wait for a module factory to be registered\n */\nexport function waitForFactory(factoryName) {\n  return new Promise((resolve) => {\n    // Check if already available\n    if (typeof window[factoryName] === \"function\") {\n      resolve(window[factoryName]);\n      return;\n    }\n\n    // Register callback to be notified when ready\n    if (!state.moduleReadyCallbacks.has(factoryName)) {\n      state.moduleReadyCallbacks.set(factoryName, []);\n    }\n    state.moduleReadyCallbacks.get(factoryName).push(resolve);\n  });\n}\n\n/**\n * Notify that a module factory is ready\n */\nexport function notifyModuleReady(factoryName) {\n  const callbacks = state.moduleReadyCallbacks.get(factoryName);\n  if (callbacks) {\n    const factory = window[factoryName];\n    callbacks.forEach(cb => cb(factory));\n    state.moduleReadyCallbacks.delete(factoryName);\n  }\n}\n\n/**\n * Get icon for content type\n */\nexport function getTypeIcon(type) {\n  switch (type) {\n    case \"module\":\n      return '<i class=\"fa-solid fa-gear\"></i>';\n    case \"page\":\n      return '<i class=\"fa-regular fa-file\"></i>';\n    case \"document\":\n      return '<i class=\"fa-regular fa-file-lines\"></i>';\n    case \"folder\":\n      return '<i class=\"fa-regular fa-folder\"></i>';\n    case \"back\":\n      return '<i class=\"fa-solid fa-caret-left\"></i>';\n    default:\n      return '<i class=\"fa-solid fa-circle\"></i>';\n  }\n}","/**\n * Theme management module\n * Handles dark/light theme toggling and asset switching with preloading\n */\n\nimport { dom, state, themeController } from '../core/state.js';\n\n// Cache for preloaded images\nconst imageCache = {\n  'logo-dark': null,\n  'logo-light': null,\n  'banner-dark': null,\n  'banner-light': null\n};\n\n/**\n * Preload all theme images (logos and banners only)\n */\nfunction preloadThemeImages() {\n  const images = [\n    { key: 'logo-dark', src: './assets/logo-dark.png' },\n    { key: 'logo-light', src: './assets/logo-light.png' },\n    { key: 'banner-dark', src: './assets/banner-dark.png' },\n    { key: 'banner-light', src: './assets/banner-light.png' }\n  ];\n\n  images.forEach(({ key, src }) => {\n    const img = new Image();\n    img.src = src;\n    imageCache[key] = img;\n  });\n\n  console.log('[Theme] Theme assets preloaded');\n}\n\n/**\n * Set theme color in meta tag\n */\nexport function setThemeMetaColor(theme) {\n  const themeColorMeta = document.getElementById('theme-color-meta');\n  \n  if (themeColorMeta) {\n    themeColorMeta.setAttribute(\"content\", theme === \"dark\" ? \"#1f1f1f\" : \"#f3f4f6\");\n  }\n}\n\n/**\n * Update logo and banner based on theme with slide-up animation\n */\nexport function updateThemeAssets(theme) {\n  const headerLogo = document.getElementById('headerLogo');\n  const headerBanner = document.getElementById('headerBanner');\n  const headerTagline = document.querySelector('.header-tagline');\n  const landscapeLogo = document.getElementById('landscapeLogo');\n  \n  if (headerLogo && headerBanner) {\n    // Step 1: Remove existing animations by removing class\n    headerLogo.classList.remove('animate');\n    headerBanner.classList.remove('animate');\n    if (headerTagline) {\n      headerTagline.classList.remove('animate');\n    }\n    \n    // Step 2: Force reflow to ensure animation can restart\n    void headerLogo.offsetWidth;\n    void headerBanner.offsetWidth;\n    if (headerTagline) {\n      void headerTagline.offsetWidth;\n    }\n    \n    // Step 3: Temporarily disable animation on elements\n    headerLogo.style.animation = 'none';\n    headerBanner.style.animation = 'none';\n    if (headerTagline) {\n      headerTagline.style.animation = 'none';\n    }\n    \n    // Step 4: Switch source immediately\n    headerLogo.src = theme === 'dark' \n      ? './assets/logo-dark.png' \n      : './assets/logo-light.png';\n    \n    headerBanner.src = theme === 'dark' \n      ? './assets/banner-dark.png' \n      : './assets/banner-light.png';\n    \n    // Step 5: Re-enable animation and add animate class in next frame\n    requestAnimationFrame(() => {\n      // Remove inline style to restore CSS animation\n      headerLogo.style.animation = '';\n      headerBanner.style.animation = '';\n      if (headerTagline) {\n        headerTagline.style.animation = '';\n      }\n      \n      // Add animate class to trigger animation\n      requestAnimationFrame(() => {\n        headerLogo.classList.add('animate');\n        headerBanner.classList.add('animate');\n        if (headerTagline) {\n          headerTagline.classList.add('animate');\n        }\n      });\n    });\n  }\n\n  // Update landscape left bar logo WITH animation\n  if (landscapeLogo) {\n    // Step 1: Remove existing animation\n    landscapeLogo.classList.remove('animate');\n    \n    // Step 2: Force reflow\n    void landscapeLogo.offsetWidth;\n    \n    // Step 3: Temporarily disable animation\n    landscapeLogo.style.animation = 'none';\n    \n    // Step 4: Switch source\n    landscapeLogo.src = theme === 'dark' \n      ? './assets/logo-dark.png' \n      : './assets/logo-light.png';\n    \n    // Step 5: Re-enable animation\n    requestAnimationFrame(() => {\n      landscapeLogo.style.animation = '';\n      requestAnimationFrame(() => {\n        landscapeLogo.classList.add('animate');\n      });\n    });\n  }\n}\n\n/**\n * Toggle between dark and light themes\n */\nexport function toggleTheme() {\n  const current = dom.htmlEl.getAttribute(\"data-theme\") || \"dark\";\n  const next = current === \"dark\" ? \"light\" : \"dark\";\n  dom.htmlEl.setAttribute(\"data-theme\", next);\n  \n  // Update main theme icon\n  dom.themeIcon.textContent = next === \"dark\" ? \"☾\" : \"☼\";\n  \n  // Update landscape theme icon\n  const landscapeThemeIcon = document.getElementById('landscapeThemeIcon');\n  if (landscapeThemeIcon) {\n    landscapeThemeIcon.textContent = next === \"dark\" ? \"☾\" : \"☼\";\n  }\n  \n  setThemeMetaColor(next);\n  updateThemeAssets(next);\n\n  const event = new CustomEvent(\"themechange\", { detail: { theme: next } });\n  document.dispatchEvent(event);\n\n  if (state.activeInstance && typeof state.activeInstance.onThemeChange === \"function\") {\n    setTimeout(() => state.activeInstance.onThemeChange(next), 50);\n  }\n}\n\n/**\n * Initialize theme system\n */\nexport function initTheme() {\n  // Preload all theme images immediately\n  preloadThemeImages();\n\n  // Main theme toggle\n  dom.themeToggleBtn.addEventListener(\"click\", toggleTheme);\n\n  // Landscape left bar theme toggle\n  const landscapeThemeToggle = document.getElementById('landscapeThemeToggle');\n  if (landscapeThemeToggle) {\n    landscapeThemeToggle.addEventListener(\"click\", toggleTheme);\n  }\n\n  const initialTheme = dom.htmlEl.getAttribute(\"data-theme\") || \"dark\";\n  dom.themeIcon.textContent = initialTheme === \"dark\" ? \"☾\" : \"☼\";\n  \n  // Set initial landscape theme icon\n  const landscapeThemeIcon = document.getElementById('landscapeThemeIcon');\n  if (landscapeThemeIcon) {\n    landscapeThemeIcon.textContent = initialTheme === \"dark\" ? \"☾\" : \"☼\";\n  }\n  \n  setThemeMetaColor(initialTheme);\n}","/**\n * Sidebar management module\n * Handles sidebar width application and hover behavior\n * Width computation is now done during preload (cached)\n */\n\nimport { dom, state } from '../core/state.js';\nimport { isDesktopOrTablet } from '../core/utils.js';\n\n// Track hover state explicitly\nlet isCurrentlyHovering = false;\n\n/**\n * Check if in landscape mode\n */\nfunction isLandscapeMode() {\n  return window.matchMedia('(max-height: 600px) and (orientation: landscape)').matches;\n}\n\n/**\n * Apply sidebar width based on current hover state\n * Uses pre-computed cached values from preloader\n */\nexport function applySidebarWidth() {\n  // Skip width application in landscape mode (CSS handles it)\n  if (isLandscapeMode()) return;\n  \n  if (!isDesktopOrTablet()) return;\n  if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") return;\n\n  // Use tracked hover state and cached values\n  if (isCurrentlyHovering && state.hoverNeeded) {\n    dom.sidebar.style.width = state.hoverSidebarWidth + \"px\";\n    console.log('[Sidebar] Applied cached hover width:', state.hoverSidebarWidth);\n  } else {\n    dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n    console.log('[Sidebar] Applied base width:', state.baseSidebarWidth);\n  }\n}\n\n/**\n * Toggle sidebar open/closed state\n */\nexport function toggleSidebar() {\n  const isOpen = dom.sidebar.getAttribute(\"data-open\") === \"true\";\n  const next = !isOpen;\n\n  // In landscape mode, use simpler toggle (CSS handles positioning)\n  if (isLandscapeMode()) {\n    dom.sidebar.setAttribute(\"data-open\", String(next));\n    dom.sidebarToggle.setAttribute(\"data-open\", String(next));\n    \n    const landscapeToggle = document.getElementById('landscapeToggle');\n    if (landscapeToggle) {\n      landscapeToggle.setAttribute(\"data-open\", String(next));\n    }\n    return;\n  }\n\n  if (isDesktopOrTablet()) {\n    if (next) {\n      dom.sidebar.setAttribute(\"data-open\", \"true\");\n      dom.sidebarToggle.setAttribute(\"data-open\", \"true\");\n      \n      // Sync landscape toggle if exists\n      const landscapeToggle = document.getElementById('landscapeToggle');\n      if (landscapeToggle) {\n        landscapeToggle.setAttribute(\"data-open\", \"true\");\n      }\n      \n      dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n    } else {\n      const currentWidth = dom.sidebar.getBoundingClientRect().width;\n      dom.sidebar.style.width = currentWidth + \"px\";\n      dom.sidebar.setAttribute(\"data-open\", \"false\");\n      dom.sidebarToggle.setAttribute(\"data-open\", \"false\");\n      \n      // Sync landscape toggle if exists\n      const landscapeToggle = document.getElementById('landscapeToggle');\n      if (landscapeToggle) {\n        landscapeToggle.setAttribute(\"data-open\", \"false\");\n      }\n\n      // Reset hover state when closing\n      isCurrentlyHovering = false;\n\n      setTimeout(() => {\n        if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") {\n          dom.sidebar.style.width = \"\";\n        }\n      }, 250);\n    }\n  } else {\n    dom.sidebar.setAttribute(\"data-open\", String(next));\n    dom.sidebarToggle.setAttribute(\"data-open\", String(next));\n    \n    // Sync landscape toggle if exists\n    const landscapeToggle = document.getElementById('landscapeToggle');\n    if (landscapeToggle) {\n      landscapeToggle.setAttribute(\"data-open\", String(next));\n    }\n  }\n}\n\n/**\n * Clear active state from all sidebar items\n */\nexport function clearSidebarActive() {\n  const items = dom.sidebarNav.querySelectorAll(\".nav-item\");\n  items.forEach((b) => b.classList.remove(\"active\"));\n}\n\n/**\n * Handle sidebar mouse enter event\n */\nfunction handleSidebarMouseEnter() {\n  // Skip hover behavior in landscape mode\n  if (isLandscapeMode()) return;\n  \n  if (!isDesktopOrTablet()) return;\n  if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") return;\n\n  isCurrentlyHovering = true;\n  console.log('[Sidebar] Mouse enter - using cached hoverNeeded:', state.hoverNeeded);\n\n  if (!state.hoverNeeded) {\n    dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n    return;\n  }\n  dom.sidebar.style.width = state.hoverSidebarWidth + \"px\";\n}\n\n/**\n * Handle sidebar mouse leave event\n */\nfunction handleSidebarMouseLeave(e) {\n  // Skip hover behavior in landscape mode\n  if (isLandscapeMode()) return;\n  \n  if (!isDesktopOrTablet()) return;\n  if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") return;\n\n  const related = e.relatedTarget;\n  if (related && dom.sidebar.contains(related)) {\n    return;\n  }\n\n  isCurrentlyHovering = false;\n  console.log('[Sidebar] Mouse leave - resetting to base width');\n  dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n}\n\n/**\n * Initialize sidebar event listeners\n */\nexport function initSidebar() {\n  // Main sidebar toggle\n  dom.sidebarToggle.addEventListener(\"click\", toggleSidebar);\n  \n  // Landscape left bar sidebar toggle\n  const landscapeToggle = document.getElementById('landscapeToggle');\n  if (landscapeToggle) {\n    landscapeToggle.addEventListener(\"click\", toggleSidebar);\n  }\n  \n  // Hover behavior\n  dom.sidebar.addEventListener(\"mouseenter\", handleSidebarMouseEnter);\n  dom.sidebar.addEventListener(\"mouseleave\", handleSidebarMouseLeave);\n}","/**\n * Content loading module\n * Handles loading of modules, pages, and documents\n */\n\nimport { dom, state, themeController } from '../core/state.js';\nimport { scriptUrlFromFile, factoryNameFromId, waitForFactory } from '../core/utils.js';\n\n/**\n * Typeset math expressions using MathJax\n */\nexport function typesetMath(rootEl) {\n  if (window.MathJax && window.MathJax.typesetPromise) {\n    window.MathJax.typesetPromise([rootEl]).catch(function (err) {\n      console.error(\"MathJax typeset failed\", err);\n    });\n  }\n}\n\n/**\n * Clear active module instance\n */\nexport function clearActiveInstance() {\n  if (state.activeInstance && typeof state.activeInstance.destroy === \"function\") {\n    try {\n      state.activeInstance.destroy();\n    } catch (e) {\n      // ignore destroy errors\n    }\n  }\n  state.activeInstance = null;\n}\n\n/**\n * Load a script file once (with caching)\n */\nexport function loadScriptOnce(src) {\n  return new Promise((resolve, reject) => {\n    if (state.loadedScripts.has(src)) {\n      resolve();\n      return;\n    }\n\n    const existing = document.querySelector(\n      'script[data-module-src=\"' + src + '\"]'\n    );\n    if (existing) {\n      state.loadedScripts.add(src);\n      resolve();\n      return;\n    }\n\n    const script = document.createElement(\"script\");\n    script.src = src;\n    script.defer = true;\n    script.dataset.moduleSrc = src;\n\n    script.onload = () => {\n      state.loadedScripts.add(src);\n      resolve();\n    };\n    script.onerror = () => {\n      console.error(\"Failed to load script:\", src);\n      reject(new Error(\"Failed to load script: \" + src));\n    };\n\n    document.head.appendChild(script);\n  });\n}\n\n/**\n * Get factory function for a module\n */\nexport function getFactoryForModule(node) {\n  if (state.moduleFactories.has(node.id)) {\n    return Promise.resolve(state.moduleFactories.get(node.id));\n  }\n\n  const scriptSrc = scriptUrlFromFile(node.file);\n  const factoryName = factoryNameFromId(node.id);\n\n  return loadScriptOnce(scriptSrc).then(() => {\n    return waitForFactory(factoryName).then((factory) => {\n      if (typeof factory !== \"function\") {\n        throw new Error(\n          \"Factory \" + factoryName + \" is not a function for module \" + node.id\n        );\n      }\n      state.moduleFactories.set(node.id, factory);\n      return factory;\n    });\n  });\n}\n\n/**\n * Load a module (interactive tool/calculator)\n * Note: Shared CSS patterns loaded via modules.css in index.html\n * Module-specific styles are inlined in each module's JS file\n */\nexport function loadModule(node, done) {\n  console.log('[ContentLoader] Loading module:', node.id);\n  \n  getFactoryForModule(node)\n    .then((factory) => {\n      const innerRoot = document.createElement(\"div\");\n      innerRoot.className = \"content-root\";\n      dom.card.appendChild(innerRoot);\n\n      let instance = null;\n      try {\n        console.log('[ContentLoader] Creating module instance:', node.id);\n        instance = factory({ root: innerRoot, themeController }) || {};\n      } catch (err) {\n        console.error('[ContentLoader] Module instantiation failed:', err);\n        dom.card.innerHTML = \"\\n\\nUnable to load module.\";\n        dom.card.classList.remove(\"preload\");\n        dom.card.classList.add(\"loaded\");\n        done(null);\n        return;\n      }\n\n      requestAnimationFrame(() => {\n        // Removed: Redundant sidebar label update\n        // Tree generator already extracted <h1> at build time\n        // Sidebar label should remain stable from tree.json\n        \n        typesetMath(innerRoot);\n        dom.card.classList.remove(\"preload\");\n        dom.card.classList.add(\"loaded\");\n        \n        console.log('[ContentLoader] Module loaded successfully:', node.id);\n      });\n\n      done(instance);\n    })\n    .catch((err) => {\n      console.error('[ContentLoader] Module loading failed:', err);\n      dom.card.innerHTML = \"\\n\\nUnable to load module.\";\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done(null);\n    });\n}\n\n/**\n * Load a page (static HTML content)\n */\nexport function loadPage(node, done) {\n  const url = scriptUrlFromFile(node.file);\n  fetch(url)\n    .then((res) => {\n      if (!res.ok) throw new Error(\"Failed to load page: \" + url);\n      return res.text();\n    })\n    .then((html) => {\n      dom.card.innerHTML = html;\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done({});\n    })\n    .catch((err) => {\n      console.error(err);\n      dom.card.innerHTML = \"\\n\\nUnable to load page.\";\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done(null);\n    });\n}\n\n/**\n * Load a document (text/markdown content)\n */\nexport function loadDocument(node, done) {\n  const url = scriptUrlFromFile(node.file);\n  fetch(url)\n    .then((res) => {\n      if (!res.ok) throw new Error(\"Failed to load document: \" + url);\n      return res.text();\n    })\n    .then((md) => {\n      const inner = document.createElement(\"div\");\n      inner.className = \"document-root\";\n      const pre = document.createElement(\"pre\");\n      pre.textContent = md;\n      inner.appendChild(pre);\n      dom.card.appendChild(inner);\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done({});\n    })\n    .catch((err) => {\n      console.error(err);\n      dom.card.innerHTML = \"\\n\\nUnable to load document.\";\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done(null);\n    });\n}\n\n/**\n * Open a node (module/page/document)\n */\nexport function openNode(node) {\n  if (!node) return;\n\n  clearActiveInstance();\n\n  dom.card.classList.remove(\"loaded\");\n  dom.card.classList.add(\"preload\");\n  dom.card.innerHTML = \"\";\n\n  const type = node.type;\n\n  if (type === \"module\") {\n    loadModule(node, (instance) => {\n      state.activeInstance = instance || {};\n      state.activeNode = node;\n    });\n  } else if (type === \"page\") {\n    loadPage(node, (instance) => {\n      state.activeInstance = instance || {};\n      state.activeNode = node;\n    });\n  } else if (type === \"document\") {\n    loadDocument(node, (instance) => {\n      state.activeInstance = instance || {};\n      state.activeNode = node;\n    });\n  } else {\n    dom.card.classList.remove(\"preload\");\n    dom.card.classList.add(\"loaded\");\n    state.activeInstance = {};\n    state.activeNode = node;\n  }\n}","/**\n * Search functionality module\n * Handles search indexing, querying, and results display\n */\n\nimport { dom, state } from '../core/state.js';\nimport { findNodeByPath, findParentFolder, getTypeIcon, isDesktopOrTablet } from '../core/utils.js';\nimport { navigateToFolder } from './navigation.js';\nimport { clearSidebarActive, toggleSidebar } from './sidebar.js';\nimport { openNode } from './content-loader.js';\n\n/**\n * Build searchable index from navigation tree\n */\nexport function buildSearchIndex(node, pathArray = [], parentNode = null) {\n  const index = [];\n\n  if (!node) return index;\n\n  const currentPath = pathArray.length > 0 ? pathArray.join(\" > \") : \"\";\n\n  // Index folders\n  if (node.type === \"folder\" && node.name) {\n    index.push({\n      type: \"folder\",\n      name: node.name,\n      path: node.path,\n      displayPath: currentPath,\n      searchText: node.name.toLowerCase(),\n      node: node,\n      parentNode: parentNode\n    });\n  }\n\n  // Index modules, pages, documents\n  if (node.type === \"module\" || node.type === \"page\" || node.type === \"document\") {\n    const title = state.moduleDisplayNames[node.id] || node.title || node.id || \"\";\n    const tags = (node.tags || []).join(\" \").toLowerCase();\n\n    index.push({\n      type: node.type,\n      id: node.id,\n      title: title,\n      path: node.path,\n      displayPath: currentPath,\n      searchText: (title + \" \" + tags).toLowerCase(),\n      node: node,\n      parentNode: parentNode\n    });\n  }\n\n  // Recursively index children\n  if (node.children && node.children.length > 0) {\n    const newPath = node.name ? [...pathArray, node.name] : pathArray;\n    node.children.forEach(child => {\n      index.push(...buildSearchIndex(child, newPath, node));\n    });\n  }\n\n  return index;\n}\n\n/**\n * Rebuild the search index\n */\nexport function rebuildSearchIndex() {\n  if (!state.navigationTree) return;\n  state.searchIndex = buildSearchIndex(state.navigationTree);\n  console.log('[Search] Index rebuilt with', state.searchIndex.length, 'items');\n}\n\n/**\n * Score a search match\n */\nfunction scoreMatch(searchText, query) {\n  const lowerQuery = query.toLowerCase();\n  const lowerText = searchText.toLowerCase();\n\n  // Exact match gets highest score\n  if (lowerText === lowerQuery) return 1000;\n\n  // Starts with query\n  if (lowerText.startsWith(lowerQuery)) return 500;\n\n  // Contains query as whole word\n  const words = lowerText.split(/\\s+/);\n  for (const word of words) {\n    if (word.startsWith(lowerQuery)) return 300;\n    if (word.includes(lowerQuery)) return 150;\n  }\n\n  // Contains query anywhere (substring match)\n  if (lowerText.includes(lowerQuery)) return 100;\n\n  return 0;\n}\n\n/**\n * Search items in the index\n */\nfunction searchItems(query) {\n  if (!query || query.trim().length < 2) return [];\n\n  const trimmedQuery = query.trim();\n  const results = [];\n\n  state.searchIndex.forEach(item => {\n    const score = scoreMatch(item.searchText, trimmedQuery);\n    if (score > 0) {\n      results.push({ ...item, score });\n    }\n  });\n\n  // Sort by score (highest first), then alphabetically\n  results.sort((a, b) => {\n    if (b.score !== a.score) return b.score - a.score;\n    const aName = a.title || a.name || \"\";\n    const bName = b.title || b.name || \"\";\n    return aName.localeCompare(bName);\n  });\n\n  return results.slice(0, 15);\n}\n\n/**\n * Highlight matching text in search results\n */\nfunction highlightMatch(text, query) {\n  if (!query || !text) return text;\n\n  const lowerText = text.toLowerCase();\n  const lowerQuery = query.toLowerCase();\n  const index = lowerText.indexOf(lowerQuery);\n\n  if (index === -1) return text;\n\n  const before = text.substring(0, index);\n  const match = text.substring(index, index + query.length);\n  const after = text.substring(index + query.length);\n\n  return before + '<span class=\"search-match\">' + match + '</span>' + after;\n}\n\n/**\n * Render search results\n */\nfunction renderSearchResults(results, query) {\n  state.selectedResultIndex = -1;\n\n  if (results.length === 0) {\n    dom.searchResults.innerHTML = '<div class=\"search-no-results\">No results found</div>';\n    dom.searchResults.style.display = \"block\";\n    return;\n  }\n\n  const html = results.map((item, index) => {\n    const displayName = item.title || item.name || \"\";\n    const highlightedName = highlightMatch(displayName, query);\n    const icon = getTypeIcon(item.type);\n\n    return `\n      <div class=\"search-result-item\" data-index=\"${index}\">\n        <div class=\"search-result-title\">\n          <span class=\"search-result-icon\">${icon}</span>\n          <span>${highlightedName}</span>\n        </div>\n        ${item.displayPath ? `<div class=\"search-result-path\">${item.displayPath}</div>` : \"\"}\n      </div>\n    `;\n  }).join(\"\");\n\n  dom.searchResults.innerHTML = html;\n  dom.searchResults.style.display = \"block\";\n\n  // Add click listeners\n  dom.searchResults.querySelectorAll(\".search-result-item\").forEach((el, index) => {\n    el.addEventListener(\"click\", () => {\n      handleResultSelection(results[index]);\n    });\n  });\n}\n\n/**\n * Handle selection of a search result\n */\nfunction handleResultSelection(item) {\n  console.log('[Search] Selected item:', item);\n  \n  if (!item || !item.node) {\n    console.error('[Search] Invalid item or node');\n    return;\n  }\n\n  if (item.type === \"folder\") {\n    // Navigate to folder using unified function\n    console.log('[Search] Navigating to folder:', item.node.path);\n    navigateToFolder(item.node);\n  } else {\n    // For modules/pages/documents - use stored parent from index\n    let parentNode = item.parentNode;\n    \n    console.log('[Search] Item details:', {\n      itemType: item.type,\n      itemPath: item.path,\n      itemNode: item.node,\n      parentNode: parentNode\n    });\n\n    if (parentNode && parentNode.type === 'folder') {\n      console.log('[Search] Navigating to parent folder:', parentNode.path || 'Home');\n      \n      // Navigate to parent folder (triggers all folder navigation actions)\n      navigateToFolder(parentNode);\n      \n      // Wait for folder navigation to complete, then open the item\n      requestAnimationFrame(() => {\n        console.log('[Search] Opening item:', item.node.id);\n        clearSidebarActive();\n        openNode(item.node);\n\n        // Highlight the active item in sidebar after opening\n        setTimeout(() => {\n          const navItem = dom.sidebarNav.querySelector(\n            '.nav-item[data-type=\"' + item.node.type + '\"][data-id=\"' + item.node.id + '\"]'\n          );\n          if (navItem) {\n            navItem.classList.add(\"active\");\n            console.log('[Search] Activated nav item');\n          } else {\n            console.warn('[Search] Could not find nav item for', item.node.id);\n          }\n        }, 50);\n      });\n    } else {\n      console.error('[Search] Could not find valid parent folder');\n    }\n  }\n\n  // Clear search UI\n  dom.searchInput.value = \"\";\n  dom.searchClear.style.display = \"none\";\n  dom.searchResults.style.display = \"none\";\n  dom.searchResults.innerHTML = \"\";\n\n  // Close sidebar on mobile\n  if (!isDesktopOrTablet()) {\n    setTimeout(() => toggleSidebar(), 300);\n  }\n}\n\n/**\n * Update selected result with keyboard navigation\n */\nfunction updateSelectedResult(direction) {\n  const items = dom.searchResults.querySelectorAll(\".search-result-item\");\n  if (items.length === 0) return;\n\n  // Remove previous selection\n  if (state.selectedResultIndex >= 0 && state.selectedResultIndex < items.length) {\n    items[state.selectedResultIndex].classList.remove(\"selected\");\n  }\n\n  // Update index\n  if (direction === \"down\") {\n    state.selectedResultIndex = (state.selectedResultIndex + 1) % items.length;\n  } else if (direction === \"up\") {\n    state.selectedResultIndex = state.selectedResultIndex <= 0 ? items.length - 1 : state.selectedResultIndex - 1;\n  }\n\n  // Add new selection\n  if (state.selectedResultIndex >= 0 && state.selectedResultIndex < items.length) {\n    items[state.selectedResultIndex].classList.add(\"selected\");\n    items[state.selectedResultIndex].scrollIntoView({ block: \"nearest\" });\n  }\n}\n\n/**\n * Initialize search functionality\n */\nexport function initSearch() {\n  let searchDebounceTimer = null;\n\n  dom.searchInput.addEventListener(\"input\", (e) => {\n    const query = e.target.value;\n\n    // Show/hide clear button\n    dom.searchClear.style.display = query.length > 0 ? \"flex\" : \"none\";\n\n    // Debounce search\n    clearTimeout(searchDebounceTimer);\n\n    if (query.trim().length === 0) {\n      dom.searchResults.style.display = \"none\";\n      dom.searchResults.innerHTML = \"\";\n      return;\n    }\n\n    searchDebounceTimer = setTimeout(() => {\n      const results = searchItems(query);\n      renderSearchResults(results, query);\n    }, 200);\n  });\n\n  dom.searchInput.addEventListener(\"keydown\", (e) => {\n    const resultsVisible = dom.searchResults.style.display === \"block\";\n\n    if (e.key === \"Escape\") {\n      dom.searchInput.value = \"\";\n      dom.searchClear.style.display = \"none\";\n      dom.searchResults.style.display = \"none\";\n      dom.searchResults.innerHTML = \"\";\n      dom.searchInput.blur();\n    } else if (e.key === \"ArrowDown\" && resultsVisible) {\n      e.preventDefault();\n      updateSelectedResult(\"down\");\n    } else if (e.key === \"ArrowUp\" && resultsVisible) {\n      e.preventDefault();\n      updateSelectedResult(\"up\");\n    } else if (e.key === \"Enter\" && resultsVisible) {\n      e.preventDefault();\n      const results = searchItems(dom.searchInput.value);\n      if (state.selectedResultIndex >= 0 && state.selectedResultIndex < results.length) {\n        handleResultSelection(results[state.selectedResultIndex]);\n      } else if (results.length > 0) {\n        handleResultSelection(results[0]);\n      }\n    }\n  });\n\n  dom.searchClear.addEventListener(\"click\", () => {\n    dom.searchInput.value = \"\";\n    dom.searchClear.style.display = \"none\";\n    dom.searchResults.style.display = \"none\";\n    dom.searchResults.innerHTML = \"\";\n    dom.searchInput.focus();\n  });\n\n  // Keyboard Shortcut: Ctrl+K or Cmd+K to Focus Search\n  document.addEventListener(\"keydown\", (e) => {\n    if ((e.ctrlKey || e.metaKey) && e.key === \"k\") {\n      e.preventDefault();\n      dom.searchInput.focus();\n\n      // Open sidebar if closed\n      if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") {\n        toggleSidebar();\n      }\n    }\n  });\n\n  // Close Search Results When Clicking Outside\n  document.addEventListener(\"click\", (e) => {\n    if (!dom.searchInput.contains(e.target) &&\n        !dom.searchResults.contains(e.target) &&\n        !dom.searchClear.contains(e.target)) {\n      if (dom.searchResults.style.display === \"block\") {\n        dom.searchResults.style.display = \"none\";\n      }\n    }\n  });\n}","/**\n * Module preloading system\n * Preloads modules in a folder for better performance\n * Calculates sidebar width from JSON metadata using actual DOM measurement\n */\n\nimport { state, themeController } from '../core/state.js';\nimport { scriptUrlFromFile, factoryNameFromId, waitForFactory } from '../core/utils.js';\nimport { renderSidebar } from './navigation.js';\nimport { rebuildSearchIndex } from './search.js';\n\n/**\n * Measure actual width needed for label texts using temporary DOM element\n * This ensures accurate measurement matching real CSS\n */\nfunction measureLabelsWidth(labelTexts) {\n  if (labelTexts.length === 0) return 240;\n\n  // Create temporary hidden container\n  const tempContainer = document.createElement('div');\n  tempContainer.style.position = 'absolute';\n  tempContainer.style.left = '-99999px';\n  tempContainer.style.top = '-99999px';\n  tempContainer.style.visibility = 'hidden';\n  tempContainer.style.pointerEvents = 'none';\n  document.body.appendChild(tempContainer);\n\n  let maxLabelWidth = 0;\n\n  labelTexts.forEach(text => {\n    // Create element with exact same styles as real nav-label\n    const label = document.createElement('span');\n    label.className = 'nav-label';\n    label.textContent = text;\n    \n    // Apply critical styles that affect width measurement\n    label.style.fontSize = '1.2rem';\n    label.style.lineHeight = '1.1';\n    label.style.whiteSpace = 'nowrap';\n    label.style.display = 'inline-block';\n    \n    tempContainer.appendChild(label);\n\n    // Force reflow to ensure accurate measurement\n    void label.offsetWidth;\n\n    const width = label.getBoundingClientRect().width;\n    \n    if (width > maxLabelWidth) {\n      maxLabelWidth = width;\n    }\n\n    tempContainer.removeChild(label);\n  });\n\n  document.body.removeChild(tempContainer);\n\n  // Calculate total needed width using your formula:\n  const navIndexWidth = 24;      // \"01\", \"02\" etc\n  const navIconWidth = 24;       // icon + margins\n  const padding = 12;            // sidebar padding\n  const extraMargin = 30;        // safety margin\n  \n  const totalNeeded = navIndexWidth + navIconWidth + maxLabelWidth + padding + extraMargin;\n  \n  console.log('[Preloader] Width measurement:', {\n    maxLabelWidth: Math.ceil(maxLabelWidth),\n    navIndexWidth: navIndexWidth,\n    navIconWidth: navIconWidth,\n    padding: padding,\n    extraMargin: extraMargin,\n    totalNeeded: Math.ceil(totalNeeded)\n  });\n\n  return Math.ceil(totalNeeded);\n}\n\n/**\n * Calculate sidebar width for a folder from JSON metadata\n * Measures actual rendered width using temporary DOM element\n */\nfunction calculateFolderWidth(folderNode) {\n  if (!folderNode || !folderNode.children) return { width: 240, hoverNeeded: false };\n\n  const labelTexts = folderNode.children\n    .map(child => {\n      if (child.type === 'folder') {\n        return child.name || '';\n      } else if (child.type === 'module' || child.type === 'page' || child.type === 'document') {\n        return child.title || child.id || '';\n      }\n      return '';\n    })\n    .filter(text => text.length > 0);\n\n  const width = measureLabelsWidth(labelTexts);\n  const hoverNeeded = width > state.baseSidebarWidth;\n\n  return { width, hoverNeeded };\n}\n\n/**\n * Preload modules in a folder for better performance\n * Width calculation is instant using JSON titles\n */\nexport function preloadFolderModules(folderNode) {\n  if (!folderNode || !folderNode.children) return;\n\n  const folderPath = folderNode.path || 'Home';\n\n  // Calculate and cache width immediately from JSON\n  if (!state.folderWidthCache.has(folderPath)) {\n    const { width, hoverNeeded } = calculateFolderWidth(folderNode);\n    \n    state.folderWidthCache.set(folderPath, { width, hoverNeeded });\n    state.hoverSidebarWidth = width;\n    state.hoverNeeded = hoverNeeded;\n    \n    console.log('[Preloader] Calculated and cached width for', folderPath, ':', {\n      width: width,\n      hoverNeeded: hoverNeeded\n    });\n  } else {\n    const cachedWidth = state.folderWidthCache.get(folderPath);\n    state.hoverSidebarWidth = cachedWidth.width;\n    state.hoverNeeded = cachedWidth.hoverNeeded;\n    console.log('[Preloader] Using cached width for', folderPath);\n  }\n\n  // Render sidebar immediately with calculated width\n  renderSidebar(folderNode);\n  rebuildSearchIndex();\n\n  // Now preload modules in background (for faster loading when clicked)\n  const modulesToPreload = folderNode.children.filter(\n    (child) => child.type === \"module\" && !state.preloadedModules.has(child.id)\n  );\n  \n  if (modulesToPreload.length === 0) {\n    console.log('[Preloader] No modules to preload for', folderPath);\n    return;\n  }\n\n  console.log('[Preloader] Starting background preload of', modulesToPreload.length, 'modules');\n\n  function preloadNext(index) {\n    if (index >= modulesToPreload.length) {\n      console.log('[Preloader] All modules preloaded');\n      return;\n    }\n\n    const mod = modulesToPreload[index];\n    const scriptSrc = scriptUrlFromFile(mod.file);\n\n    if (state.loadedScripts.has(scriptSrc)) {\n      state.preloadedModules.add(mod.id);\n      if (window.requestIdleCallback) {\n        requestIdleCallback(() => preloadNext(index + 1));\n      } else {\n        setTimeout(() => preloadNext(index + 1), 0);\n      }\n      return;\n    }\n\n    console.log('[Preloader] Loading module', index + 1, '/', modulesToPreload.length, ':', mod.id);\n\n    const script = document.createElement(\"script\");\n    script.src = scriptSrc;\n    script.defer = true;\n    script.dataset.moduleSrc = scriptSrc;\n\n    script.onload = () => {\n      state.loadedScripts.add(scriptSrc);\n\n      const factoryName = factoryNameFromId(mod.id);\n\n      waitForFactory(factoryName).then((factory) => {\n        if (typeof factory !== \"function\") {\n          console.warn(\"Factory \" + factoryName + \" is not a function for module \" + mod.id + \". Skipping preload.\");\n          state.preloadedModules.add(mod.id);\n          if (window.requestIdleCallback) {\n            requestIdleCallback(() => preloadNext(index + 1));\n          } else {\n            setTimeout(() => preloadNext(index + 1), 0);\n          }\n          return;\n        }\n\n        const hiddenRoot = document.createElement(\"div\");\n        hiddenRoot.style.position = \"absolute\";\n        hiddenRoot.style.left = \"-99999px\";\n        hiddenRoot.style.top = \"-99999px\";\n        hiddenRoot.style.width = \"1px\";\n        hiddenRoot.style.height = \"1px\";\n        hiddenRoot.style.overflow = \"hidden\";\n        document.body.appendChild(hiddenRoot);\n\n        let instance = null;\n        try {\n          instance = factory({ root: hiddenRoot, themeController }) || {};\n        } catch (err) {\n          console.error(err);\n        }\n\n        requestAnimationFrame(() => {\n          const heading = hiddenRoot.querySelector(\"h1\");\n          if (heading && heading.textContent) {\n            state.moduleDisplayNames[mod.id] = heading.textContent.trim();\n            console.log('[Preloader] Extracted display name for', mod.id, ':', state.moduleDisplayNames[mod.id]);\n          }\n\n          if (instance && typeof instance.destroy === \"function\") {\n            try {\n              instance.destroy();\n            } catch (e) {\n              // ignore destroy errors\n            }\n          }\n          document.body.removeChild(hiddenRoot);\n          state.preloadedModules.add(mod.id);\n\n          if (window.requestIdleCallback) {\n            requestIdleCallback(() => preloadNext(index + 1));\n          } else {\n            setTimeout(() => preloadNext(index + 1), 0);\n          }\n        });\n      });\n    };\n\n    script.onerror = () => {\n      console.error(\"Failed to preload script:\", scriptSrc);\n      state.preloadedModules.add(mod.id);\n      if (window.requestIdleCallback) {\n        requestIdleCallback(() => preloadNext(index + 1));\n      } else {\n        setTimeout(() => preloadNext(index + 1), 0);\n      }\n    };\n\n    document.head.appendChild(script);\n  }\n\n  preloadNext(0);\n}\n\n/**\n * Get initial folder on page load\n */\nexport function getInitialFolder(tree) {\n  return tree;\n}","/**\n * Navigation module\n * Handles breadcrumb and sidebar navigation rendering\n */\n\nimport { dom, state } from '../core/state.js';\nimport { findNodeByPath, findLeafById, getTypeIcon } from '../core/utils.js';\nimport { clearSidebarActive, applySidebarWidth, toggleSidebar } from './sidebar.js';\nimport { preloadFolderModules } from './preloader.js';\nimport { openNode } from './content-loader.js';\nimport { isDesktopOrTablet } from '../core/utils.js';\n\n/**\n * Render breadcrumb navigation\n */\nexport function renderBreadcrumb() {\n  if (!state.navigationTree || !state.currentFolder) return;\n  if (!dom.sidebarBreadcrumb) return;\n\n  dom.sidebarBreadcrumb.innerHTML = \"\";\n\n  const fullPath = state.currentFolder.path || \"Home\";\n  const segments = fullPath.split(\"/\");\n\n  segments.forEach((segment, index) => {\n    const isLast = index === segments.length - 1;\n    const path = segments.slice(0, index + 1).join(\"/\");\n\n    const part = document.createElement(\"span\");\n    part.textContent = segment;\n    part.className = \"sidebar-breadcrumb-part\" + (isLast ? \" current\" : \"\");\n\n    if (!isLast) {\n      part.addEventListener(\"click\", () => {\n        if (path === state.currentFolder.path) return;\n        const node = findNodeByPath(state.navigationTree, path);\n        if (!node || node.type !== \"folder\") return;\n\n        navigateToFolder(node);\n      });\n    }\n\n    dom.sidebarBreadcrumb.appendChild(part);\n\n    if (!isLast) {\n      const sep = document.createElement(\"span\");\n      sep.textContent = \"/\";\n      sep.className = \"sidebar-breadcrumb-separator\";\n      dom.sidebarBreadcrumb.appendChild(sep);\n    }\n  });\n}\n\n/**\n * Navigate to a folder - unified function for all folder navigation\n * This triggers all necessary actions: render sidebar, preload, calculate width\n */\nexport function navigateToFolder(folderNode) {\n  console.log('[Navigation] Navigating to folder:', folderNode.path || 'Home');\n  renderSidebar(folderNode);\n  preloadFolderModules(folderNode);\n}\n\n/**\n * Render sidebar navigation for a folder\n */\nexport function renderSidebar(folderNode) {\n  console.log('[Navigation] Rendering sidebar for folder:', folderNode.path || 'Home');\n  \n  state.currentFolder = folderNode;\n  dom.sidebarNav.innerHTML = \"\";\n\n  renderBreadcrumb();\n\n  const items = [];\n\n  // Add \"Back\" button if not at root\n  if (folderNode !== state.navigationTree) {\n    const parentPath = folderNode.path.split(\"/\").slice(0, -1).join(\"/\");\n    const parentNode = findNodeByPath(state.navigationTree, parentPath);\n    if (parentNode) {\n      const upItem = document.createElement(\"button\");\n      upItem.type = \"button\";\n      upItem.className = \"nav-item\";\n      upItem.setAttribute(\"data-type\", \"folder\");\n      upItem.setAttribute(\"data-path\", parentNode.path);\n      upItem.innerHTML = `\n        <span class=\"nav-index\"></span>\n        <span class=\"nav-icon\">${getTypeIcon(\"back\")}</span>\n        <span class=\"nav-label\">Back</span>\n      `;\n      items.push(upItem);\n    }\n  }\n\n  // Add folder children\n  if (folderNode.children) {\n    folderNode.children.forEach((child, index) => {\n      const btn = document.createElement(\"button\");\n      btn.type = \"button\";\n      btn.className = \"nav-item\";\n\n      if (child.type === \"folder\") {\n        btn.setAttribute(\"data-type\", \"folder\");\n        btn.setAttribute(\"data-path\", child.path);\n        btn.innerHTML = `\n          <span class=\"nav-index\">${String(index + 1).padStart(2, \"0\")}</span>\n          <span class=\"nav-icon\">${getTypeIcon(\"folder\")}</span>\n          <span class=\"nav-label\">${child.name}</span>\n        `;\n      } else {\n        // module, page, document\n        btn.setAttribute(\"data-type\", child.type);\n        btn.setAttribute(\"data-id\", child.id);\n        const label =\n          state.moduleDisplayNames[child.id] ||\n          child.title ||\n          child.id ||\n          \"Loading\";\n        btn.innerHTML = `\n          <span class=\"nav-index\">${String(index + 1).padStart(2, \"0\")}</span>\n          <span class=\"nav-icon\">${getTypeIcon(child.type)}</span>\n          <span class=\"nav-label\">${label}</span>\n        `;\n\n        if (state.activeNode && state.activeNode.id === child.id) {\n          btn.classList.add(\"active\");\n        }\n      }\n\n      items.push(btn);\n    });\n  }\n\n  items.forEach((btn) => dom.sidebarNav.appendChild(btn));\n\n  // Add click event listeners\n  dom.sidebarNav.querySelectorAll(\".nav-item\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => {\n      const type = btn.getAttribute(\"data-type\");\n\n      if (type === \"folder\") {\n        const path = btn.getAttribute(\"data-path\");\n        if (!path) return;\n        const node = findNodeByPath(state.navigationTree, path);\n        if (!node) return;\n\n        navigateToFolder(node);\n        return;\n      }\n\n      if (type === \"module\" || type === \"page\" || type === \"document\") {\n        const id = btn.getAttribute(\"data-id\");\n        if (!id) return;\n        const node = findLeafById(state.navigationTree, id);\n        if (!node) return;\n\n        clearSidebarActive();\n        btn.classList.add(\"active\");\n        openNode(node);\n\n        if (!isDesktopOrTablet()) {\n          toggleSidebar();\n        }\n      }\n    });\n  });\n\n  // Apply cached width (no measurement needed!)\n  console.log('[Navigation] Applying cached width values');\n  applySidebarWidth();\n}","/**\n * Detects notch position in landscape mode and applies appropriate CSS class\n */\n\nexport function initSafeAreaDetector() {\n  function detectNotchPosition() {\n    // Only run in landscape mode\n    const isLandscape = window.matchMedia('(max-height: 600px) and (orientation: landscape)').matches;\n    \n    if (!isLandscape) {\n      document.documentElement.removeAttribute('data-notch-side');\n      console.log('[SafeArea] Not in landscape mode');\n      return;\n    }\n\n    // Method 1: Use screen.orientation.angle\n    // 90 = notch on left, 270/-90 = notch on right\n    let angle = 0;\n    \n    if (window.screen && window.screen.orientation) {\n      angle = window.screen.orientation.angle;\n    } else if (window.orientation !== undefined) {\n      angle = window.orientation;\n    }\n    \n    console.log('[SafeArea] Orientation angle:', angle);\n    \n    // Determine notch side based on angle\n    // Most devices: 90° = rotated left (notch on left), -90°/270° = rotated right (notch on right)\n    if (angle === 90) {\n      document.documentElement.setAttribute('data-notch-side', 'left');\n      console.log('[SafeArea] Angle 90° - Notch on LEFT');\n    } else if (angle === -90 || angle === 270) {\n      document.documentElement.setAttribute('data-notch-side', 'right');\n      console.log('[SafeArea] Angle -90°/270° - Notch on RIGHT');\n    } else {\n      // Fallback: Try measuring safe areas\n      console.log('[SafeArea] Unknown angle, measuring safe areas...');\n      measureSafeAreas();\n    }\n  }\n\n  function measureSafeAreas() {\n    // Use getComputedStyle on root element with CSS variables\n    const root = document.documentElement;\n    \n    // Set CSS custom properties to read env() values\n    root.style.setProperty('--test-safe-left', 'env(safe-area-inset-left, 0px)');\n    root.style.setProperty('--test-safe-right', 'env(safe-area-inset-right, 0px)');\n    \n    const computedStyle = getComputedStyle(root);\n    const leftValue = computedStyle.getPropertyValue('--test-safe-left').trim();\n    const rightValue = computedStyle.getPropertyValue('--test-safe-right').trim();\n    \n    console.log('[SafeArea] Computed left:', leftValue, 'right:', rightValue);\n    \n    // Parse pixel values\n    const leftPx = parseFloat(leftValue) || 0;\n    const rightPx = parseFloat(rightValue) || 0;\n    \n    console.log('[SafeArea] Parsed left:', leftPx, 'right:', rightPx);\n    \n    if (leftPx > 20) {\n      document.documentElement.setAttribute('data-notch-side', 'left');\n      console.log('[SafeArea] Measured - Notch on LEFT');\n    } else if (rightPx > 20) {\n      document.documentElement.setAttribute('data-notch-side', 'right');\n      console.log('[SafeArea] Measured - Notch on RIGHT');\n    } else {\n      document.documentElement.setAttribute('data-notch-side', 'none');\n      console.log('[SafeArea] Measured - No notch detected');\n    }\n    \n    // Clean up\n    root.style.removeProperty('--test-safe-left');\n    root.style.removeProperty('--test-safe-right');\n  }\n\n  // Initial detection\n  setTimeout(detectNotchPosition, 200);\n\n  // Re-detect on orientation change\n  if (window.screen && window.screen.orientation) {\n    window.screen.orientation.addEventListener('change', () => {\n      console.log('[SafeArea] Screen orientation changed');\n      setTimeout(detectNotchPosition, 300);\n    });\n  }\n\n  // Fallback: orientationchange event\n  window.addEventListener('orientationchange', () => {\n    console.log('[SafeArea] Orientation change event fired');\n    setTimeout(detectNotchPosition, 300);\n  });\n\n  // Backup: resize event\n  let resizeTimeout;\n  window.addEventListener('resize', () => {\n    clearTimeout(resizeTimeout);\n    resizeTimeout = setTimeout(() => {\n      console.log('[SafeArea] Resize detected, checking orientation');\n      detectNotchPosition();\n    }, 250);\n  });\n}","// javascript/utilities/mathJax.js\n// Global MathJax utility - loads once, shared across all modules\n\nlet mathJaxLoaded = false;\nlet mathJaxLoadingPromise = null;\n\n/**\n * Load MathJax globally (lazy-loaded on first use)\n * Hybrid approach: JS from local, fonts from CDN\n * Safe to call multiple times - only loads once\n * @returns {Promise<void>}\n */\nexport async function loadMathJax() {\n  if (mathJaxLoaded) {\n    return Promise.resolve();\n  }\n\n  if (mathJaxLoadingPromise) {\n    return mathJaxLoadingPromise;\n  }\n\n  console.log('[MathJax Utility] Loading MathJax (hybrid mode)...');\n\n  mathJaxLoadingPromise = new Promise((resolve, reject) => {\n    // Configure MathJax before loading\n    window.MathJax = {\n      tex: {\n        inlineMath: [[\"\\\\(\", \"\\\\)\"], [\"$\", \"$\"]],\n        displayMath: [[\"\\\\[\", \"\\\\]\"], [\"$$\", \"$$\"]]\n      },\n      chtml: {\n        // Use CDN for fonts (default jsdelivr path)\n        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'\n      },\n      options: {\n        skipHtmlTags: [\"script\", \"noscript\", \"style\", \"textarea\", \"pre\"]\n      },\n      startup: {\n        ready: () => {\n          window.MathJax.startup.defaultReady();\n          mathJaxLoaded = true;\n          console.log('[MathJax Utility] MathJax loaded (JS: local, fonts: CDN)');\n          resolve();\n        }\n      }\n    };\n\n    // Load main bundle from local vendor directory\n    const script = document.createElement('script');\n    script.src = './vendor/mathjax/tex-mml-chtml.js';\n    script.async = true;\n    script.onerror = () => {\n      console.error('[MathJax Utility] Failed to load MathJax bundle');\n      console.error('[MathJax Utility] Make sure to run: npm run setup:mathjax');\n      reject(new Error('Failed to load MathJax bundle'));\n    };\n    document.head.appendChild(script);\n  });\n\n  return mathJaxLoadingPromise;\n}\n\n/**\n * Check if MathJax is already loaded\n * @returns {boolean}\n */\nexport function isMathJaxLoaded() {\n  return mathJaxLoaded;\n}\n\n/**\n * Typeset math equations in a specific container\n * Automatically loads MathJax if not already loaded\n * @param {HTMLElement} container - Container element to typeset\n * @returns {Promise<void>}\n */\nexport async function typesetMath(container) {\n  await loadMathJax();\n\n  if (window.MathJax?.typesetPromise) {\n    await window.MathJax.typesetPromise([container]);\n  }\n}\n","/**\n * Main application entry point\n * Orchestrates all modules and handles initialization\n */\n\nimport { dom, state, initDOMRefs } from './core/state.js';\nimport { notifyModuleReady, isDesktopOrTablet, isMediumViewport } from './core/utils.js';\nimport { initTheme } from './modules/theme.js';\nimport { initSidebar, toggleSidebar } from './modules/sidebar.js';\nimport { renderSidebar } from './modules/navigation.js';\nimport { openNode } from './modules/content-loader.js';\nimport { preloadFolderModules, getInitialFolder } from './modules/preloader.js';\nimport { initSearch, rebuildSearchIndex } from './modules/search.js';\nimport { initSafeAreaDetector } from './modules/safe-area-detector.js';\nimport * as MathJaxUtil from './utilities/mathJax.js';\n\n(function () {\n  \"use strict\";\n\n  console.log('[App] Initializing application...');\n\n  // Register global module ready notification\n  window.__moduleReady = notifyModuleReady;\n\n  // Expose MathJax utility globally for non-module scripts (e.g., preloaded calculators)\n  window.MathJaxUtility = MathJaxUtil;\n  console.log('[App] MathJax utility exposed globally');\n\n  /**\n   * Initialize application on page load\n   */\n  window.addEventListener(\"load\", () => {\n    console.log('[App] Page loaded, initializing DOM references');\n\n    // Initialize DOM references first\n    initDOMRefs();\n    initSafeAreaDetector();\n\n    // Initialize all modules\n    initTheme();\n    initSidebar();\n    initSearch();\n\n    console.log('[App] Fetching navigation tree');\n\n    // Load navigation tree from static JSON\n    fetch(\"./javascript/tree.json\")\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(\"Failed to load navigation tree\");\n        }\n        return res.json();\n      })\n      .then((tree) => {\n        console.log('[App] Navigation tree loaded');\n        state.navigationTree = tree;\n\n        const initialFolder = getInitialFolder(state.navigationTree);\n\n        renderSidebar(initialFolder);\n        preloadFolderModules(initialFolder);\n\n        // Build search index after tree is loaded\n        rebuildSearchIndex();\n\n        // Default node: first module/page/document directly under that folder\n        let defaultNode = null;\n        if (initialFolder.children) {\n          defaultNode =\n            initialFolder.children.find(\n              (c) =>\n                c.type === \"module\" ||\n                c.type === \"page\" ||\n                c.type === \"document\"\n            ) || null;\n        }\n\n        if (defaultNode) {\n          const defaultBtn = dom.sidebarNav.querySelector(\n            '.nav-item[data-type=\"' +\n              defaultNode.type +\n              '\"][data-id=\"' +\n              defaultNode.id +\n              '\"]'\n          );\n          if (defaultBtn) {\n            defaultBtn.classList.add(\"active\");\n          }\n          openNode(defaultNode);\n        } else {\n          dom.card.classList.remove(\"preload\");\n          dom.card.classList.add(\"loaded\");\n        }\n      })\n      .catch((err) => {\n        console.error('[App] Failed to load navigation tree:', err);\n        dom.card.classList.remove(\"preload\");\n        dom.card.classList.add(\"loaded\");\n      });\n  });\n\n  /**\n   * Handle window resize\n   */\n  window.addEventListener(\"resize\", () => {\n    if (!isDesktopOrTablet()) {\n      dom.sidebar.style.width = \"\";\n    } else {\n      if (dom.sidebar.getAttribute(\"data-open\") === \"true\") {\n        dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n      } else {\n        dom.sidebar.style.width = \"\";\n      }\n    }\n  });\n\n  /**\n   * Auto-collapse sidebar when clicking on main content (for medium viewports/tablets)\n   */\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    initDOMRefs();\n\n    if (dom.card) {\n      dom.card.addEventListener(\"click\", () => {\n        if (isMediumViewport() && dom.sidebar.getAttribute(\"data-open\") === \"true\") {\n          toggleSidebar();\n        }\n      });\n    }\n\n    if (dom.mainContent) {\n      dom.mainContent.addEventListener(\"click\", (e) => {\n        if (e.target === dom.mainContent || e.target.classList.contains(\"page-root\")) {\n          if (isMediumViewport() && dom.sidebar.getAttribute(\"data-open\") === \"true\") {\n            toggleSidebar();\n          }\n        }\n      });\n    }\n  });\n\n  console.log('[App] Initialization complete');\n})();\n"],"names":["state","activeInstance","activeNode","baseSidebarWidth","hoverSidebarWidth","hoverNeeded","searchIndex","selectedResultIndex","moduleDisplayNames","preloadedModules","Set","navigationTree","currentFolder","loadedScripts","moduleFactories","Map","moduleReadyCallbacks","folderWidthCache","themeController","getTheme","document","documentElement","getAttribute","subscribe","fn","addEventListener","removeEventListener","dom","htmlEl","sidebar","sidebarToggle","sidebarNav","sidebarBreadcrumb","card","themeToggleBtn","themeIcon","searchInput","searchClear","searchResults","mainContent","initDOMRefs","getElementById","querySelector","findNodeByPath","node","path","children","child","found","findLeafById","id","type","isDesktopOrTablet","window","innerWidth","isMediumViewport","scriptUrlFromFile","filePath","factoryNameFromId","charAt","toUpperCase","slice","waitForFactory","factoryName","Promise","resolve","has","set","get","push","notifyModuleReady","callbacks","factory","forEach","cb","delete","getTypeIcon","setThemeMetaColor","theme","themeColorMeta","setAttribute","toggleTheme","next","textContent","landscapeThemeIcon","headerLogo","headerBanner","headerTagline","landscapeLogo","classList","remove","offsetWidth","style","animation","src","requestAnimationFrame","add","updateThemeAssets","event","CustomEvent","detail","dispatchEvent","onThemeChange","setTimeout","initTheme","key","Image","landscapeThemeToggle","initialTheme","isCurrentlyHovering","isLandscapeMode","matchMedia","matches","toggleSidebar","String","landscapeToggle","width","currentWidth","getBoundingClientRect","clearSidebarActive","querySelectorAll","b","handleSidebarMouseEnter","handleSidebarMouseLeave","e","related","relatedTarget","contains","getFactoryForModule","scriptSrc","file","reject","script","createElement","defer","dataset","moduleSrc","onload","onerror","console","error","Error","head","appendChild","then","loadModule","done","innerRoot","className","instance","root","err","innerHTML","rootEl","MathJax","typesetPromise","catch","openNode","destroy","clearActiveInstance","url","fetch","res","ok","text","html","loadPage","md","inner","pre","loadDocument","buildSearchIndex","pathArray","parentNode","index","currentPath","length","join","name","displayPath","searchText","toLowerCase","title","tags","newPath","rebuildSearchIndex","searchItems","query","trim","trimmedQuery","results","item","score","lowerQuery","lowerText","startsWith","words","split","word","includes","scoreMatch","sort","a","aName","bName","localeCompare","handleResultSelection","navigateToFolder","navItem","warn","value","display","updateSelectedResult","direction","items","scrollIntoView","block","initSearch","searchDebounceTimer","target","clearTimeout","map","highlightedName","indexOf","substring","highlightMatch","el","renderSearchResults","resultsVisible","blur","preventDefault","focus","ctrlKey","metaKey","calculateFolderWidth","folderNode","labelTexts","tempContainer","position","left","top","visibility","pointerEvents","body","maxLabelWidth","label","fontSize","lineHeight","whiteSpace","removeChild","totalNeeded","navIndexWidth","Math","ceil","measureLabelsWidth","filter","preloadFolderModules","folderPath","cachedWidth","renderSidebar","modulesToPreload","preloadNext","mod","requestIdleCallback","hiddenRoot","height","overflow","heading","segments","segment","isLast","part","sep","renderBreadcrumb","parentPath","upItem","btn","padStart","initSafeAreaDetector","detectNotchPosition","removeAttribute","angle","screen","orientation","undefined","setProperty","computedStyle","getComputedStyle","leftValue","getPropertyValue","rightValue","leftPx","parseFloat","rightPx","removeProperty","measureSafeAreas","resizeTimeout","mathJaxLoaded","mathJaxLoadingPromise","async","loadMathJax","tex","inlineMath","displayMath","chtml","fontURL","options","skipHtmlTags","startup","ready","defaultReady","container","__moduleReady","MathJaxUtility","MathJaxUtil","initSidebar","json","tree","initialFolder","defaultNode","find","c","defaultBtn"],"mappings":"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"}