{"version":3,"file":"app.min.js","sources":["core/state.js","core/utils.js","modules/theme.js","loader/platform-resources.js","loader/fontawesome-loader.js","modules/sidebar.js","loader/mathjax-loader.js","loader/index.js","core/message-tunnel.js","core/instance-manager.js","core/dom-isolation.js","modules/content-loader.js","core/js-isolation.js","modules/navigation.js","modules/preloader.js","modules/search.js","modules/safe-area-detector.js","modules/pwa.js","app.js","modules/keyboard-shortcuts.js"],"sourcesContent":["/**\n * Central state management for the application\n * All shared state variables and constants\n */\n\nexport const state = {\n  activeInstance: null,\n  activeNode: null,\n  baseSidebarWidth: 240,\n  hoverSidebarWidth: 240,\n  hoverNeeded: false,\n  searchIndex: [],\n  selectedResultIndex: -1,\n  moduleDisplayNames: {},\n  preloadedModules: new Set(),\n  navigationTree: null,\n  currentFolder: null,\n  loadedScripts: new Set(),\n  moduleFactories: new Map(),\n  moduleReadyCallbacks: new Map(),\n  // NEW: Cache computed widths per folder path\n  folderWidthCache: new Map(),\n};\n\nexport const themeController = {\n  getTheme() {\n    return document.documentElement.getAttribute(\"data-theme\") || \"dark\";\n  },\n  subscribe(fn) {\n    document.addEventListener(\"themechange\", fn);\n    return () => document.removeEventListener(\"themechange\", fn);\n  },\n};\n\n// Export DOM references (initialized after DOM is ready)\nexport const dom = {\n  htmlEl: document.documentElement,\n  sidebar: null,\n  sidebarToggle: null,\n  sidebarNav: null,\n  sidebarBreadcrumb: null,\n  card: null,\n  themeToggleBtn: null,\n  themeIcon: null,\n  searchInput: null,\n  searchClear: null,\n  searchResults: null,\n  mainContent: null,\n};\n\n// Initialize DOM references when DOM is ready\nexport function initDOMRefs() {\n  dom.sidebar = document.getElementById(\"sidebar\");\n  dom.sidebarToggle = document.getElementById(\"sidebarToggle\");\n  dom.sidebarNav = document.getElementById(\"sidebarNav\");\n  dom.sidebarBreadcrumb = document.getElementById(\"sidebarBreadcrumb\");\n  dom.card = document.getElementById(\"contentCard\");\n  dom.themeToggleBtn = document.getElementById(\"themeToggle\");\n  dom.themeIcon = document.getElementById(\"themeIcon\");\n  dom.searchInput = document.getElementById(\"searchInput\");\n  dom.searchClear = document.getElementById(\"searchClear\");\n  dom.searchResults = document.getElementById(\"searchResults\");\n  dom.mainContent = document.querySelector(\".main-content\");\n}","/**\n * Utility functions\n * Helper functions used across multiple modules\n */\n\nimport { state } from './state.js';\n\n/**\n * Find a node by its path in the navigation tree\n */\nexport function findNodeByPath(node, path) {\n  if (node.path === path) return node;\n  if (!node.children) return null;\n  for (const child of node.children) {\n    const found = findNodeByPath(child, path);\n    if (found) return found;\n  }\n  return null;\n}\n\n/**\n * Find a leaf node (module/page/document) by its ID\n */\nexport function findLeafById(node, id) {\n  if (!node) return null;\n  if (\n    (node.type === \"module\" ||\n      node.type === \"page\" ||\n      node.type === \"document\") &&\n    node.id === id\n  ) {\n    return node;\n  }\n  if (!node.children) return null;\n  for (const child of node.children) {\n    const found = findLeafById(child, id);\n    if (found) return found;\n  }\n  return null;\n}\n\n/**\n * Find the parent folder of a given node\n */\nexport function findParentFolder(node) {\n  if (!node || !node.path) return state.navigationTree;\n\n  const pathParts = node.path.split(\"/\");\n  if (pathParts.length <= 1) return state.navigationTree;\n\n  const parentPath = pathParts.slice(0, -1).join(\"/\");\n  return findNodeByPath(state.navigationTree, parentPath) || state.navigationTree;\n}\n\n/**\n * Check if viewport is desktop or tablet size\n */\nexport function isDesktopOrTablet() {\n  return window.innerWidth >= 841;\n}\n\n/**\n * Check if viewport is medium size (tablet range)\n */\nexport function isMediumViewport() {\n  return window.innerWidth >= 841 && window.innerWidth <= 1470;\n}\n\n/**\n * Convert file path to URL\n */\nexport function scriptUrlFromFile(filePath) {\n  return \"./\" + filePath;\n}\n\n/**\n * Generate factory function name from module ID\n */\nexport function factoryNameFromId(id) {\n  return \"create\" + id.charAt(0).toUpperCase() + id.slice(1);\n}\n\n/**\n * Wait for a module factory to be registered\n */\nexport function waitForFactory(factoryName) {\n  return new Promise((resolve) => {\n    // Check if already available\n    if (typeof window[factoryName] === \"function\") {\n      resolve(window[factoryName]);\n      return;\n    }\n\n    // Register callback to be notified when ready\n    if (!state.moduleReadyCallbacks.has(factoryName)) {\n      state.moduleReadyCallbacks.set(factoryName, []);\n    }\n    state.moduleReadyCallbacks.get(factoryName).push(resolve);\n  });\n}\n\n/**\n * Notify that a module factory is ready\n */\nexport function notifyModuleReady(factoryName) {\n  const callbacks = state.moduleReadyCallbacks.get(factoryName);\n  if (callbacks) {\n    const factory = window[factoryName];\n    callbacks.forEach(cb => cb(factory));\n    state.moduleReadyCallbacks.delete(factoryName);\n  }\n}\n\n/**\n * Extract display name from module code without executing it\n * Looks for window.moduleInfo.displayName = \"...\" pattern\n * @param {string} code - Module source code\n * @returns {string|null} - Display name or null\n */\nexport function extractDisplayNameFromCode(code) {\n  if (!code || typeof code !== 'string') {\n    return null;\n  }\n  \n  // Match: window.moduleInfo = { displayName: \"Name\" }\n  const infoMatch = code.match(/window\\.moduleInfo\\s*=\\s*\\{[^}]*displayName\\s*:\\s*[\"']([^\"']+)[\"']/);\n  if (infoMatch) {\n    return infoMatch[1];\n  }\n  \n  // Fallback: Extract from function name (createMyModule → My Module)\n  const factoryMatch = code.match(/function\\s+(create\\w+)/);\n  if (factoryMatch) {\n    return factoryMatch[1]\n      .replace(/^create/, '')\n      .replace(/([A-Z])/g, ' $1')\n      .trim();\n  }\n  \n  return null;\n}\n","/**\n * Theme management module\n * Handles dark/light theme toggling and asset switching with preloading\n * PRODUCTION FIX v2: Addresses hover-triggered HTTP requests\n */\n\nimport { dom, state, themeController } from '../core/state.js';\n\n// Cache for preloaded images\nconst imageCache = {\n  'logo-dark': null,\n  'logo-light': null,\n  'banner-dark': null,\n  'banner-light': null\n};\n\n// Track if animation is in progress to debounce\nlet animationInProgress = false;\n\n/**\n * Preload all theme images (logos and banners only)\n * Returns a Promise that resolves when all images are loaded\n */\nfunction preloadThemeImages() {\n  const images = [\n    { key: 'logo-dark', src: './assets/logo-dark.png' },\n    { key: 'logo-light', src: './assets/logo-light.png' },\n    { key: 'banner-dark', src: './assets/banner-dark.png' },\n    { key: 'banner-light', src: './assets/banner-light.png' }\n  ];\n\n  // Create promises for each image load\n  const loadPromises = images.map(({ key, src }) => {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => {\n        imageCache[key] = img;\n        console.log(`[Theme] Preloaded ${key}`);\n        resolve();\n      };\n      img.onerror = () => {\n        console.warn(`[Theme] Failed to preload ${key}`);\n        imageCache[key] = img; // Store anyway, fallback to string path\n        resolve(); // Don't block on error\n      };\n      img.src = src;\n    });\n  });\n\n  return Promise.all(loadPromises).then(() => {\n    console.log('[Theme] All theme assets preloaded and ready');\n  });\n}\n\n/**\n * Set theme color in meta tag\n */\nexport function setThemeMetaColor(theme) {\n  const themeColorMeta = document.getElementById('theme-color-meta');\n\n  if (themeColorMeta) {\n    themeColorMeta.setAttribute(\"content\", theme === \"dark\" ? \"#1f1f1f\" : \"#f3f4f6\");\n  }\n}\n\n/**\n * Replace image element with cached version (NO HTTP request)\n * ENHANCED: Additional safeguards for production stability\n * @param {HTMLImageElement} targetImg - The img element to replace\n * @param {string} cacheKey - Key in imageCache\n * @param {string} fallbackSrc - Fallback URL if cache fails\n */\nfunction replaceWithCachedImage(targetImg, cacheKey, fallbackSrc) {\n  const cachedImg = imageCache[cacheKey];\n\n  if (cachedImg && cachedImg.complete && cachedImg.naturalWidth > 0) {\n    // Check if src is already correct (avoid unnecessary DOM operations)\n    if (targetImg.src === cachedImg.src) {\n      console.log(`[Theme] ${targetImg.id} already using correct cached image, skipping replace`);\n      return targetImg;\n    }\n\n    // Clone the cached image to get a fresh DOM element\n    const newImg = cachedImg.cloneNode(false);\n\n    // Copy all attributes from target (except src which is already correct)\n    Array.from(targetImg.attributes).forEach(attr => {\n      if (attr.name !== 'src') {\n        newImg.setAttribute(attr.name, attr.value);\n      }\n    });\n\n    // Copy computed classes\n    newImg.className = targetImg.className;\n\n    // PRODUCTION FIX: Block all interactions to prevent hover prefetching\n    newImg.style.pointerEvents = 'none';\n    newImg.style.userSelect = 'none';\n\n    // Replace in DOM (this uses the cached bitmap, NO HTTP request)\n    targetImg.parentNode.replaceChild(newImg, targetImg);\n\n    console.log(`[Theme] Replaced ${targetImg.id} with cached image (0 HTTP requests)`);\n    return newImg;\n  } else {\n    // Fallback: set src directly (will trigger HTTP request)\n    console.warn(`[Theme] Cache miss for ${cacheKey}, using fallback (HTTP request)`);\n    targetImg.src = fallbackSrc;\n    return targetImg;\n  }\n}\n\n/**\n * Clean up animation state after completion\n * Removes will-change to free GPU resources\n */\nfunction cleanupAnimation(element) {\n  if (!element) return;\n\n  // Remove will-change after animation completes\n  element.addEventListener('animationend', function handler() {\n    element.style.willChange = 'auto';\n    element.removeEventListener('animationend', handler);\n  }, { once: true });\n}\n\n/**\n * Update logo and banner based on theme with slide-up animation\n */\nexport function updateThemeAssets(theme) {\n  // Debounce: prevent rapid successive calls during hover\n  if (animationInProgress) {\n    console.log('[Theme] Animation in progress, skipping update');\n    return;\n  }\n\n  animationInProgress = true;\n\n  let headerLogo = document.getElementById('headerLogo');\n  let headerBanner = document.getElementById('headerBanner');\n  const headerTagline = document.querySelector('.header-tagline');\n  let landscapeLogo = document.getElementById('landscapeLogo');\n\n  if (headerLogo && headerBanner) {\n    // Step 1: Remove existing animations by removing class\n    headerLogo.classList.remove('animate');\n    headerBanner.classList.remove('animate');\n    if (headerTagline) {\n      headerTagline.classList.remove('animate');\n    }\n\n    // Step 2: Force reflow to ensure animation can restart\n    void headerLogo.offsetWidth;\n    void headerBanner.offsetWidth;\n    if (headerTagline) {\n      void headerTagline.offsetWidth;\n    }\n\n    // Step 3: Temporarily disable animation on elements\n    headerLogo.style.animation = 'none';\n    headerBanner.style.animation = 'none';\n    if (headerTagline) {\n      headerTagline.style.animation = 'none';\n    }\n\n    // Step 4: Replace with cached images (ZERO HTTP requests)\n    const logoKey = theme === 'dark' ? 'logo-dark' : 'logo-light';\n    const bannerKey = theme === 'dark' ? 'banner-dark' : 'banner-light';\n    const logoFallback = theme === 'dark' ? './assets/logo-dark.png' : './assets/logo-light.png';\n    const bannerFallback = theme === 'dark' ? './assets/banner-dark.png' : './assets/banner-light.png';\n\n    // Replace elements (updates references since new elements are created)\n    headerLogo = replaceWithCachedImage(headerLogo, logoKey, logoFallback);\n    headerBanner = replaceWithCachedImage(headerBanner, bannerKey, bannerFallback);\n\n    // Step 5: Re-enable animation and add animate class in next frame\n    requestAnimationFrame(() => {\n      // Remove inline style to restore CSS animation\n      headerLogo.style.animation = '';\n      headerBanner.style.animation = '';\n      if (headerTagline) {\n        headerTagline.style.animation = '';\n      }\n\n      // Add animate class to trigger animation\n      requestAnimationFrame(() => {\n        headerLogo.classList.add('animate');\n        headerBanner.classList.add('animate');\n        if (headerTagline) {\n          headerTagline.classList.add('animate');\n        }\n\n        // Clean up GPU resources after animation\n        cleanupAnimation(headerLogo);\n        cleanupAnimation(headerBanner);\n        if (headerTagline) {\n          cleanupAnimation(headerTagline);\n        }\n\n        // Reset debounce flag after animation starts\n        setTimeout(() => {\n          animationInProgress = false;\n        }, 50);\n      });\n    });\n  }\n\n  // Update landscape left bar logo WITH animation\n  if (landscapeLogo) {\n    // Step 1: Remove existing animation\n    landscapeLogo.classList.remove('animate');\n\n    // Step 2: Force reflow\n    void landscapeLogo.offsetWidth;\n\n    // Step 3: Temporarily disable animation\n    landscapeLogo.style.animation = 'none';\n\n    // Step 4: Replace with cached image (ZERO HTTP requests)\n    const logoKey = theme === 'dark' ? 'logo-dark' : 'logo-light';\n    const logoFallback = theme === 'dark' ? './assets/logo-dark.png' : './assets/logo-light.png';\n\n    landscapeLogo = replaceWithCachedImage(landscapeLogo, logoKey, logoFallback);\n\n    // Step 5: Re-enable animation\n    requestAnimationFrame(() => {\n      landscapeLogo.style.animation = '';\n      requestAnimationFrame(() => {\n        landscapeLogo.classList.add('animate');\n        cleanupAnimation(landscapeLogo);\n      });\n    });\n  }\n}\n\n/**\n * Toggle between dark and light themes\n */\nexport function toggleTheme() {\n  const current = dom.htmlEl.getAttribute(\"data-theme\") || \"dark\";\n  const next = current === \"dark\" ? \"light\" : \"dark\";\n  dom.htmlEl.setAttribute(\"data-theme\", next);\n\n  // Update main theme icon\n  dom.themeIcon.textContent = next === \"dark\" ? \"☾\" : \"☼\";\n\n  // Update landscape theme icon\n  const landscapeThemeIcon = document.getElementById('landscapeThemeIcon');\n  if (landscapeThemeIcon) {\n    landscapeThemeIcon.textContent = next === \"dark\" ? \"☾\" : \"☼\";\n  }\n\n  setThemeMetaColor(next);\n  updateThemeAssets(next);\n\n  const event = new CustomEvent(\"themechange\", { detail: { theme: next } });\n  document.dispatchEvent(event);\n\n  if (state.activeInstance && typeof state.activeInstance.onThemeChange === \"function\") {\n    requestAnimationFrame(() => {\n      if (state.activeInstance && typeof state.activeInstance.onThemeChange === \"function\") {\n        state.activeInstance.onThemeChange(next);\n      }\n    });\n  }\n}\n\n/**\n * Initialize theme system\n * Returns a Promise that resolves when theme is fully initialized\n */\nexport async function initTheme() {\n  // Preload all theme images and wait for completion\n  await preloadThemeImages();\n\n  // Main theme toggle\n  dom.themeToggleBtn.addEventListener(\"click\", toggleTheme);\n\n  // Landscape left bar theme toggle\n  const landscapeThemeToggle = document.getElementById('landscapeThemeToggle');\n  if (landscapeThemeToggle) {\n    landscapeThemeToggle.addEventListener(\"click\", toggleTheme);\n  }\n\n  const initialTheme = dom.htmlEl.getAttribute(\"data-theme\") || \"dark\";\n  dom.themeIcon.textContent = initialTheme === \"dark\" ? \"☾\" : \"☼\";\n\n  // Set initial landscape theme icon\n  const landscapeThemeIcon = document.getElementById('landscapeThemeIcon');\n  if (landscapeThemeIcon) {\n    landscapeThemeIcon.textContent = initialTheme === \"dark\" ? \"☾\" : \"☼\";\n  }\n\n  setThemeMetaColor(initialTheme);\n}\n","// javascript/loader/platform-resources.js\n\n/**\n * Platform Resources Registry\n * \n * Manages injection of platform-level resources (CSS, fonts, styles)\n * into shadow DOMs for trusted third-party libraries.\n * \n * SECURITY:\n * - Only Platform Layer code can register resources\n * - User Layer modules receive resources automatically\n * - No document.head access given to User Layer\n * - All resources are vetted (MathJax, FontAwesome, etc.)\n * \n * @module PlatformResources\n */\n\n// Track all shadow roots in the application\nconst shadowRoots = new Set();\n\n// Track registered platform resources (CSS, fonts, etc.)\nconst platformResources = new Map();\n\n/**\n * Register a shadow root to receive platform resources\n * Called by dom-isolation.js when creating shadow DOM\n * \n * @param {ShadowRoot} shadowRoot - Shadow root to inject resources into\n * @param {string} instanceId - Instance ID for logging\n */\nexport function registerShadowRoot(shadowRoot, instanceId) {\n  if (!shadowRoot || !(shadowRoot instanceof ShadowRoot)) {\n    console.error('[PlatformResources] Invalid shadow root');\n    return;\n  }\n  \n  shadowRoots.add(shadowRoot);\n  console.log(`[PlatformResources] Registered shadow root for ${instanceId} (${shadowRoots.size} total)`);\n  \n  // Inject all existing platform resources into this new shadow root\n  for (const [resourceId, resource] of platformResources) {\n    if (resource.loaded) {\n      injectResourceIntoShadowRoot(shadowRoot, resource, instanceId);\n    }\n  }\n}\n\n/**\n * Unregister a shadow root (cleanup)\n * Called by instance-manager.js when destroying module\n * \n * @param {ShadowRoot} shadowRoot - Shadow root to remove\n */\nexport function unregisterShadowRoot(shadowRoot) {\n  shadowRoots.delete(shadowRoot);\n  console.log(`[PlatformResources] Unregistered shadow root (${shadowRoots.size} remaining)`);\n}\n\n/**\n * Register a platform resource (CSS file, font, etc.)\n * Called by loaders when they load external resources\n * \n * @param {Object} config - Resource configuration\n * @param {string} config.id - Unique resource ID (e.g., 'mathjax-fonts')\n * @param {string} config.type - Resource type ('css' | 'font' | 'style')\n * @param {string} config.url - CDN URL (for css/font)\n * @param {string} config.content - CSS content (for inline style)\n * @param {string} config.integrity - SRI hash (optional)\n * @param {string} config.name - Human-readable name (for logging)\n */\nexport function registerPlatformResource(config) {\n  const { id, type, url, content, integrity, name } = config;\n  \n  if (!id || !type) {\n    console.error('[PlatformResources] Invalid resource config:', config);\n    return;\n  }\n  \n  // Check if already registered\n  if (platformResources.has(id)) {\n    console.log(`[PlatformResources] Resource '${id}' already registered`);\n    return;\n  }\n  \n  const resource = {\n    id,\n    type,\n    url,\n    content,\n    integrity,\n    name: name || id,\n    loaded: false\n  };\n  \n  platformResources.set(id, resource);\n  console.log(`[PlatformResources] Registered platform resource: ${resource.name} (${type})`);\n}\n\n/**\n * Mark a platform resource as loaded and inject into all shadow roots\n * Called by loaders after resource loads successfully\n * \n * @param {string} resourceId - Resource ID to mark as loaded\n */\nexport function markResourceLoaded(resourceId) {\n  const resource = platformResources.get(resourceId);\n  \n  if (!resource) {\n    console.error(`[PlatformResources] Unknown resource ID: ${resourceId}`);\n    return;\n  }\n  \n  resource.loaded = true;\n  console.log(`[PlatformResources] Resource loaded: ${resource.name} - injecting into ${shadowRoots.size} shadow roots`);\n  \n  // Inject into ALL existing shadow roots\n  for (const shadowRoot of shadowRoots) {\n    injectResourceIntoShadowRoot(shadowRoot, resource);\n  }\n}\n\n/**\n * Inject a single resource into a single shadow root\n * \n * @private\n * @param {ShadowRoot} shadowRoot - Target shadow root\n * @param {Object} resource - Resource to inject\n * @param {string} instanceId - Instance ID (for logging)\n */\nfunction injectResourceIntoShadowRoot(shadowRoot, resource, instanceId = 'unknown') {\n  try {\n    if (resource.type === 'css') {\n      // Inject <link> tag for external CSS\n      const link = document.createElement('link');\n      link.rel = 'stylesheet';\n      link.href = resource.url;\n      link.dataset.platformResource = resource.id;\n      \n      if (resource.integrity) {\n        link.integrity = resource.integrity;\n        link.crossOrigin = 'anonymous';\n      }\n      \n      // Insert at beginning of shadow root (before module styles)\n      if (shadowRoot.firstChild) {\n        shadowRoot.insertBefore(link, shadowRoot.firstChild);\n      } else {\n        shadowRoot.appendChild(link);\n      }\n      \n      console.log(`[PlatformResources] Injected CSS link for ${resource.name} into ${instanceId}`);\n      \n    } else if (resource.type === 'style') {\n      // Inject inline <style> for CSS content\n      const style = document.createElement('style');\n      style.textContent = resource.content;\n      style.dataset.platformResource = resource.id;\n      \n      // Insert at beginning of shadow root\n      if (shadowRoot.firstChild) {\n        shadowRoot.insertBefore(style, shadowRoot.firstChild);\n      } else {\n        shadowRoot.appendChild(style);\n      }\n      \n      console.log(`[PlatformResources] Injected inline style for ${resource.name} into ${instanceId}`);\n      \n    } else if (resource.type === 'font') {\n      // Inject @font-face declaration\n      const fontStyle = document.createElement('style');\n      fontStyle.textContent = `\n        @font-face {\n          font-family: '${resource.name}';\n          src: url('${resource.url}');\n        }\n      `;\n      fontStyle.dataset.platformResource = resource.id;\n      \n      // Insert at beginning\n      if (shadowRoot.firstChild) {\n        shadowRoot.insertBefore(fontStyle, shadowRoot.firstChild);\n      } else {\n        shadowRoot.appendChild(fontStyle);\n      }\n      \n      console.log(`[PlatformResources] Injected font for ${resource.name} into ${instanceId}`);\n    }\n    \n  } catch (error) {\n    console.error(`[PlatformResources] Failed to inject resource ${resource.id}:`, error);\n  }\n}\n\n/**\n * Get list of loaded platform resources (for debugging)\n * \n * @returns {Array<Object>} Array of loaded resources\n */\nexport function getLoadedResources() {\n  return Array.from(platformResources.values()).filter(r => r.loaded);\n}\n\n/**\n * Get shadow root count (for debugging)\n * \n * @returns {number} Number of registered shadow roots\n */\nexport function getShadowRootCount() {\n  return shadowRoots.size;\n}\n","/**\n * Dynamic resource loader utility\n * Loads external CSS/JS resources on-demand with auto-detection\n */\n\nimport { registerPlatformResource, markResourceLoaded } from './platform-resources.js';\n\nconst loadedResources = new Set();\nlet fontAwesomeLoadPromise = null;\n\n/**\n * Load CSS resource dynamically\n */\nasync function loadCSS(url, integrity = null, crossorigin = 'anonymous') {\n  console.log('[DynamicLoader] Attempting to load CSS:', url);\n  \n  if (loadedResources.has(url)) {\n    console.log('[DynamicLoader] CSS already loaded, skipping:', url);\n    return Promise.resolve();\n  }\n\n  return new Promise((resolve, reject) => {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = url;\n    \n    if (integrity) {\n      link.integrity = integrity;\n      link.crossOrigin = crossorigin;\n    }\n    \n    link.onload = () => {\n      loadedResources.add(url);\n      console.log('[DynamicLoader] CSS loaded successfully:', url);\n      resolve();\n    };\n    \n    link.onerror = () => {\n      console.error('[DynamicLoader] Failed to load CSS:', url);\n      reject(new Error(`Failed to load CSS: ${url}`));\n    };\n    \n    document.head.appendChild(link);\n  });\n}\n\n/**\n * Load FontAwesome icons (singleton pattern)\n * Returns same promise for concurrent calls\n */\nexport async function loadFontAwesome() {\n  // Return existing promise if already loading\n  if (fontAwesomeLoadPromise) {\n    console.log('[DynamicLoader] FontAwesome already loading, returning existing promise');\n    return fontAwesomeLoadPromise;\n  }\n\n  // Return immediately if already loaded\n  if (loadedResources.has('fontawesome')) {\n    console.log('[DynamicLoader] FontAwesome already loaded');\n    return Promise.resolve();\n  }\n\n  console.log('[DynamicLoader] Loading FontAwesome...');\n  \n  const faURL = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css';\n  \n  // Register FontAwesome as platform resource\n  registerPlatformResource({\n    id: 'fontawesome-css',\n    type: 'css',\n    url: faURL,\n    name: 'FontAwesome Icons'\n  });\n  \n  fontAwesomeLoadPromise = loadCSS(faURL)\n  .then(() => {\n    loadedResources.add('fontawesome');\n    \n    // Mark as loaded - auto-injects into all shadow roots\n    markResourceLoaded('fontawesome-css');\n    \n    console.log('[DynamicLoader] FontAwesome loaded and injected into shadow DOMs');\n    fontAwesomeLoadPromise = null;\n  })\n  .catch((error) => {\n    console.error('[DynamicLoader] FontAwesome load failed:', error);\n    fontAwesomeLoadPromise = null;\n    throw error;\n  });\n\n  return fontAwesomeLoadPromise;\n}\n\n/**\n * Check if HTML string contains FontAwesome classes\n */\nexport function containsFontAwesomeIcons(htmlString) {\n  if (!htmlString) return false;\n  \n  const faPatterns = [\n    /class=[\"'][^\"']*\\bfa-/,\n    /class=[\"'][^\"']*\\bfas\\b/,\n    /class=[\"'][^\"']*\\bfar\\b/,\n    /class=[\"'][^\"']*\\bfab\\b/\n  ];\n  \n  return faPatterns.some(pattern => pattern.test(htmlString));\n}\n\n/**\n * Check if DOM element contains FontAwesome icons\n */\nexport function elementContainsFontAwesome(element) {\n  if (!element) return false;\n  \n  const classes = element.className;\n  if (typeof classes === 'string' && /\\bfa-|\\bfas\\b|\\bfar\\b|\\bfab\\b/.test(classes)) {\n    return true;\n  }\n  \n  const icons = element.querySelectorAll('[class*=\"fa-\"], .fas, .far, .fab');\n  return icons.length > 0;\n}\n\n/**\n * Load FontAwesome if content needs it (auto-detection)\n */\nexport async function loadIconsIfNeeded(content) {\n  let needsIcons = false;\n  \n  if (typeof content === 'string') {\n    needsIcons = containsFontAwesomeIcons(content);\n  } else if (content instanceof HTMLElement) {\n    needsIcons = elementContainsFontAwesome(content);\n  }\n  \n  if (needsIcons) {\n    console.log('[DynamicLoader] Content contains FontAwesome icons, loading...');\n    await loadFontAwesome();\n  } else {\n    console.log('[DynamicLoader] No FontAwesome icons detected in content');\n  }\n}\n\n/**\n * Get icon HTML for common types\n * Returns FontAwesome HTML without loading the library\n * Caller is responsible for ensuring icons are loaded\n */\nexport function getTypeIcon(type) {\n  switch (type) {\n    case \"module\":\n      return '<i class=\"fa-solid fa-gear\"></i>';\n    case \"page\":\n      return '<i class=\"fa-regular fa-file\"></i>';\n    case \"document\":\n      return '<i class=\"fa-regular fa-file-lines\"></i>';\n    case \"folder\":\n      return '<i class=\"fa-regular fa-folder\"></i>';\n    case \"back\":\n      return '<i class=\"fa-solid fa-caret-left\"></i>';\n    default:\n      return '<i class=\"fa-solid fa-circle\"></i>';\n  }\n}\n\n/**\n * Get custom icon HTML\n * @param {string} iconClass - FontAwesome class (e.g., 'fa-solid fa-heart')\n */\nexport function getIcon(iconClass) {\n  return `<i class=\"${iconClass}\"></i>`;\n}\n\n/**\n * Render content with auto-loaded icons\n * Detects if content needs icons and loads them automatically\n * @param {string|HTMLElement} content - Content to render\n * @param {HTMLElement} container - Container to render into\n */\nexport async function renderWithIcons(content, container) {\n  await loadIconsIfNeeded(content);\n  \n  if (typeof content === 'string') {\n    container.innerHTML = content;\n  } else if (content instanceof HTMLElement) {\n    container.appendChild(content);\n  }\n}\n","/**\n * Sidebar management module\n * Handles sidebar width application and hover behavior\n * Width computation is now done during preload (cached)\n */\n\nimport { dom, state } from '../core/state.js';\nimport { isDesktopOrTablet } from '../core/utils.js';\nimport { loadFontAwesome } from '../loader/fontawesome-loader.js';\n\n// Track hover state explicitly\nlet isCurrentlyHovering = false;\n\n// Track if sidebar content has been initialized\nlet sidebarContentInitialized = false;\n\n/**\n * Check if in landscape mode\n */\nfunction isLandscapeMode() {\n  return window.matchMedia('(max-height: 600px) and (orientation: landscape)').matches;\n}\n\n/**\n * Apply sidebar width based on current hover state\n * Uses pre-computed cached values from preloader\n */\nexport function applySidebarWidth() {\n  // Skip width application in landscape mode (CSS handles it)\n  if (isLandscapeMode()) return;\n  \n  if (!isDesktopOrTablet()) return;\n  if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") return;\n\n  // Use tracked hover state and cached values\n  if (isCurrentlyHovering && state.hoverNeeded) {\n    dom.sidebar.style.width = state.hoverSidebarWidth + \"px\";\n    console.log('[Sidebar] Applied cached hover width:', state.hoverSidebarWidth);\n  } else {\n    dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n    console.log('[Sidebar] Applied base width:', state.baseSidebarWidth);\n  }\n}\n\n/**\n * Toggle sidebar open/closed state\n */\nexport async function toggleSidebar() { \n  const isOpen = dom.sidebar.getAttribute(\"data-open\") === \"true\";\n  const next = !isOpen;\n  \n  // Initialize sidebar content on first open\n  if (next && !sidebarContentInitialized) { \n    console.log('[Sidebar] First open - initializing content with icons');\n    await initSidebarSearch();  // Load FontAwesome + inject search HTML\n    sidebarContentInitialized = true;\n  }\n\n  // In landscape mode, use simpler toggle (CSS handles positioning)\n  if (isLandscapeMode()) {\n    dom.sidebar.setAttribute(\"data-open\", String(next));\n    dom.sidebarToggle.setAttribute(\"data-open\", String(next));\n    \n    const landscapeToggle = document.getElementById('landscapeToggle');\n    if (landscapeToggle) {\n      landscapeToggle.setAttribute(\"data-open\", String(next));\n    }\n    return;\n  }\n\n  if (isDesktopOrTablet()) {\n    if (next) {\n      dom.sidebar.setAttribute(\"data-open\", \"true\");\n      dom.sidebarToggle.setAttribute(\"data-open\", \"true\");\n      \n      // Sync landscape toggle if exists\n      const landscapeToggle = document.getElementById('landscapeToggle');\n      if (landscapeToggle) {\n        landscapeToggle.setAttribute(\"data-open\", \"true\");\n      }\n      \n      dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n    } else {\n      const currentWidth = dom.sidebar.getBoundingClientRect().width;\n      dom.sidebar.style.width = currentWidth + \"px\";\n      dom.sidebar.setAttribute(\"data-open\", \"false\");\n      dom.sidebarToggle.setAttribute(\"data-open\", \"false\");\n      \n      // Sync landscape toggle if exists\n      const landscapeToggle = document.getElementById('landscapeToggle');\n      if (landscapeToggle) {\n        landscapeToggle.setAttribute(\"data-open\", \"false\");\n      }\n\n      // Reset hover state when closing\n      isCurrentlyHovering = false;\n\n      dom.sidebar.addEventListener('transitionend', function handler(e) {\n        if (e.propertyName === 'transform' && dom.sidebar.getAttribute(\"data-open\") !== \"true\") {\n          dom.sidebar.style.width = \"\";\n        }\n        dom.sidebar.removeEventListener('transitionend', handler);\n      });\n    }\n  } else {\n    dom.sidebar.setAttribute(\"data-open\", String(next));\n    dom.sidebarToggle.setAttribute(\"data-open\", String(next));\n    \n    // Sync landscape toggle if exists\n    const landscapeToggle = document.getElementById('landscapeToggle');\n    if (landscapeToggle) {\n      landscapeToggle.setAttribute(\"data-open\", String(next));\n    }\n  }\n}\n\n/**\n * Clear active state from all sidebar items\n */\nexport function clearSidebarActive() {\n  const items = dom.sidebarNav.querySelectorAll(\".nav-item\");\n  items.forEach((b) => b.classList.remove(\"active\"));\n}\n\n/**\n * Handle sidebar mouse enter event\n */\nfunction handleSidebarMouseEnter() {\n  // Skip hover behavior in landscape mode\n  if (isLandscapeMode()) return;\n  \n  if (!isDesktopOrTablet()) return;\n  if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") return;\n\n  isCurrentlyHovering = true;\n  console.log('[Sidebar] Mouse enter - using cached hoverNeeded:', state.hoverNeeded);\n\n  if (!state.hoverNeeded) {\n    dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n    return;\n  }\n  dom.sidebar.style.width = state.hoverSidebarWidth + \"px\";\n}\n\n/**\n * Handle sidebar mouse leave event\n */\nfunction handleSidebarMouseLeave(e) {\n  // Skip hover behavior in landscape mode\n  if (isLandscapeMode()) return;\n  \n  if (!isDesktopOrTablet()) return;\n  if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") return;\n\n  const related = e.relatedTarget;\n  if (related && dom.sidebar.contains(related)) {\n    return;\n  }\n\n  isCurrentlyHovering = false;\n  console.log('[Sidebar] Mouse leave - resetting to base width');\n  dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n}\n\n/**\n * Initialize sidebar search UI\n * Injects search HTML and loads icons\n */\nasync function initSidebarSearch() {  // ← ADDED: New function\n  const searchContainer = document.querySelector('.sidebar-search');\n  if (!searchContainer) {\n    console.warn('[Sidebar] .sidebar-search container not found');\n    return;\n  }\n  \n  console.log('[Sidebar] Initializing search UI with icons');\n  \n  // Load FontAwesome first\n  await loadFontAwesome();\n  \n  // Inject search HTML\n  searchContainer.innerHTML = `\n    <div class=\"search-input-wrapper\">\n      <span class=\"search-icon\">\n        <i class=\"fa-solid fa-magnifying-glass\"></i>\n      </span>\n      <input\n        type=\"text\"\n        id=\"searchInput\"\n        class=\"search-input\"\n        placeholder=\"Search (Ctrl+K)\"\n        aria-label=\"Search any pages\"\n        autocomplete=\"off\"\n      />\n      <button\n        id=\"searchClear\"\n        class=\"search-clear\"\n        type=\"button\"\n        aria-label=\"Clear search\"\n        style=\"display: none;\"\n      >\n        <i class=\"fa-solid fa-xmark\"></i>\n      </button>\n    </div>\n    <div id=\"searchResults\" class=\"search-results\" style=\"display: none;\"></div>\n  `;\n  \n  // Update DOM refs for search elements (they didn't exist at initial page load)\n  dom.searchInput = document.getElementById('searchInput');\n  dom.searchClear = document.getElementById('searchClear');\n  dom.searchResults = document.getElementById('searchResults');\n  \n  console.log('[Sidebar] Search UI initialized with updated DOM refs');\n  \n  // Initialize search event listeners now that HTML exists\n  const { initSearch } = await import('./search.js'); \n  initSearch();\n  console.log('[Sidebar] Search event listeners attached');\n}\n\n\n/**\n * Initialize sidebar event listeners\n */\nexport function initSidebar() { \n  // Main sidebar toggle\n  dom.sidebarToggle.addEventListener(\"click\", toggleSidebar);\n  \n  // Landscape left bar sidebar toggle\n  const landscapeToggle = document.getElementById('landscapeToggle');\n  if (landscapeToggle) {\n    landscapeToggle.addEventListener(\"click\", toggleSidebar);\n  }\n  \n  // Hover behavior\n  dom.sidebar.addEventListener(\"mouseenter\", handleSidebarMouseEnter);\n  dom.sidebar.addEventListener(\"mouseleave\", handleSidebarMouseLeave);\n}\n\n/**\n * Check if sidebar content has been initialized\n */\nexport function isSidebarContentInitialized() {  // ← ADDED: Export state checker\n  return sidebarContentInitialized;\n}","/**\n * MathJax Loader\n * Loads MathJax globally for rendering in global scope containers\n * Platform Layer: Has document.head access for font injection\n */\n\nimport { registerPlatformResource, markResourceLoaded } from './platform-resources.js';\n\nlet mathJaxLoaded = false;\nlet mathJaxLoadingPromise = null;\n\n/**\n * Load MathJax globally (lazy-loaded on first use)\n * Safe to call multiple times - only loads once\n * @returns {Promise<void>}\n */\nexport async function loadMathJax() {\n  if (mathJaxLoaded) {\n    return Promise.resolve();\n  }\n\n  if (mathJaxLoadingPromise) {\n    return mathJaxLoadingPromise;\n  }\n\n  console.log('[MathJax Loader] Loading MathJax from CDN...');\n  \n  // Register MathJax output styles as platform resource\n  registerPlatformResource({\n    id: 'mathjax-output-css',\n    type: 'style',\n    name: 'MathJax Output CSS',\n    content: `\n      /* MathJax SVG Output Styling */\n      mjx-container {\n        display: inline-block;\n        margin: 0;\n        padding: 0;\n      }\n      \n      mjx-container[display=\"true\"] {\n        display: block;\n        margin: 1em 0;\n        text-align: center;\n      }\n      \n      /* Inherit theme colors */\n      mjx-container {\n        color: inherit;\n      }\n      \n      mjx-container svg {\n        display: inline-block;\n        vertical-align: middle;\n      }\n    `\n  });\n\n  mathJaxLoadingPromise = new Promise((resolve, reject) => {\n    // Configure MathJax BEFORE loading script\n    window.MathJax = {\n      tex: {\n        inlineMath: [[\"\\\\(\", \"\\\\)\"], [\"$\", \"$\"]],\n        displayMath: [[\"\\\\[\", \"\\\\]\"], [\"$$\", \"$$\"]]\n      },\n      svg: {\n        fontCache: 'global'  // Use SVG output (works better with shadow DOM)\n      },\n      options: {\n        skipHtmlTags: [\"script\", \"noscript\", \"style\", \"textarea\", \"pre\"]\n      },\n      startup: {\n        ready: () => {\n          window.MathJax.startup.defaultReady();\n          mathJaxLoaded = true;\n          \n          // Mark CSS resource as loaded (auto-injects into all shadow roots)\n          markResourceLoaded('mathjax-output-css');\n          \n          console.log('[MathJax Loader] MathJax loaded and styles injected into shadow DOMs');\n          resolve();\n        }\n      }\n    };\n\n    // Load MathJax from CDN (use SVG output for shadow DOM compatibility)\n    const script = document.createElement('script');\n    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js';\n    script.async = true;\n    script.onerror = () => {\n      console.error('[MathJax Loader] Failed to load MathJax from CDN');\n      mathJaxLoadingPromise = null;\n      reject(new Error('Failed to load MathJax'));\n    };\n    document.head.appendChild(script);\n  });\n\n  return mathJaxLoadingPromise;\n}\n\n/**\n * Check if MathJax is already loaded\n * @returns {boolean}\n */\nexport function isMathJaxLoaded() {\n  return mathJaxLoaded;\n}\n\n/**\n * Typeset math equations in ANY container (shadow DOM or global scope)\n * Platform Resources system handles style injection automatically\n * @param {HTMLElement} container - Container with LaTeX equations\n * @returns {Promise<void>}\n */\nexport async function typesetMath(container) {\n  if (!container) {\n    console.warn('[MathJax Loader] typesetMath called with null container');\n    return;\n  }\n\n  await loadMathJax();\n\n  if (window.MathJax?.typesetPromise) {\n    try {\n      console.log('[MathJax Loader] Typesetting math in global scope container...');\n      await window.MathJax.typesetPromise([container]);\n      console.log('[MathJax Loader] Typesetting complete');\n    } catch (error) {\n      console.error('[MathJax Loader] Typesetting failed:', error);\n    }\n  }\n}","/**\n * Central Loader Registry\n * Provides unified access to all lazy-loaded libraries\n */\n\nimport { \n  loadFontAwesome,\n  elementContainsFontAwesome\n} from './fontawesome-loader.js';\nimport { \n  loadMathJax, \n  typesetMath \n} from './mathjax-loader.js';\n\n// Re-export MathJax loader\nexport { loadMathJax, typesetMath } from './mathjax-loader.js';\n\n// Re-export FontAwesome loader + helpers\nexport { \n  loadFontAwesome,\n  containsFontAwesomeIcons,\n  elementContainsFontAwesome,\n  loadIconsIfNeeded,\n  getTypeIcon, \n  getIcon,\n  renderWithIcons\n} from './fontawesome-loader.js';\n\n// Future loaders can be added here:\n// export { loadChartJS } from './chartjs-loader.js';\n// export { loadPrism } from './prism-loader.js';\n\n/**\n * Auto-render all passive content (icons, math, etc.)\n * Scans container and loads only what's needed\n * @param {HTMLElement} container - Container to scan and render\n * @returns {Promise<void>}\n */\nexport async function autoRender(container) {\n  if (!container) return;\n  \n  console.log('[Loader] Auto-rendering passive content...');\n  \n  const loadPromises = [];\n  \n  // Check for FontAwesome icons\n  if (elementContainsFontAwesome(container)) {\n    console.log('[Loader] Detected FontAwesome icons');\n    loadPromises.push(loadFontAwesome());\n  }\n  \n  // Check for MathJax (look for \\( \\) or \\[ \\] patterns)\n  const html = container.innerHTML;\n  if (/\\\\\\(|\\\\\\[|\\$\\$?/.test(html)) {\n    console.log('[Loader] Detected math expressions');\n    loadPromises.push(loadMathJax().then(() => typesetMath(container)));\n  }\n  \n  // Load all detected libraries in parallel\n  if (loadPromises.length > 0) {\n    await Promise.all(loadPromises);\n    console.log('[Loader] Auto-render complete');\n  } else {\n    console.log('[Loader] No passive content detected');\n  }\n}\n\n/**\n * Re-render passive content after dynamic DOM updates\n * Handles all platform resources that need re-processing\n * @param {HTMLElement} container - Container with updated content\n * @returns {Promise<void>}\n */\nexport async function dynamicRender(container) {\n  if (!container) return;\n  \n  console.log('[Loader] Dynamic re-render...');\n  \n  const rerenderPromises = [];\n  \n  // Re-typeset math if MathJax is loaded\n  if (window.MathJax?.typesetPromise) {\n    const html = container.innerHTML;\n    // Check for LaTeX delimiters: \\( \\) \\[ \\] $ $$\n    if (/\\\\\\(|\\\\\\[|\\$\\$?/.test(html)) {\n      rerenderPromises.push(typesetMath(container));\n    }\n  }\n  \n  // Icons don't need re-rendering (CSS-based)\n  // Future: Add other library re-renders here (Prism syntax highlighting, etc.)\n  \n  if (rerenderPromises.length > 0) {\n    await Promise.all(rerenderPromises);\n    console.log('[Loader] Dynamic re-render complete');\n  }\n}\n","/**\n * Message Tunnel for Inter-Module Communication\n * Safe, controlled communication between isolated modules\n */\n\nclass MessageTunnel {\n  constructor() {\n    this.subscribers = new Map(); // instanceId -> Set of callbacks\n    this.messageLog = []; // For debugging\n  }\n  \n  /**\n   * Send message to specific instance\n   */\n  send(fromInstanceId, toInstanceId, message) {\n    console.log(`[Tunnel] ${fromInstanceId} → ${toInstanceId}:`, message);\n    \n    // Log message\n    this.messageLog.push({\n      timestamp: Date.now(),\n      from: fromInstanceId,\n      to: toInstanceId,\n      message: message\n    });\n    \n    // Deliver to subscribers\n    const callbacks = this.subscribers.get(toInstanceId);\n    if (callbacks && callbacks.size > 0) {\n      const envelope = {\n        from: fromInstanceId,\n        to: toInstanceId,\n        message: message,\n        timestamp: Date.now()\n      };\n      \n      callbacks.forEach(callback => {\n        try {\n          callback(envelope);\n        } catch (error) {\n          console.error(`[Tunnel] Error in message handler for ${toInstanceId}:`, error);\n        }\n      });\n    } else {\n      console.warn(`[Tunnel] No subscribers for ${toInstanceId}`);\n    }\n  }\n  \n  /**\n   * Broadcast message to all instances\n   */\n  broadcast(fromInstanceId, message) {\n    console.log(`[Tunnel] Broadcast from ${fromInstanceId}:`, message);\n    \n    this.subscribers.forEach((callbacks, toInstanceId) => {\n      if (toInstanceId !== fromInstanceId) {\n        this.send(fromInstanceId, toInstanceId, message);\n      }\n    });\n  }\n  \n  /**\n   * Subscribe to messages for an instance\n   */\n  subscribe(instanceId, callback) {\n    if (!this.subscribers.has(instanceId)) {\n      this.subscribers.set(instanceId, new Set());\n    }\n    \n    this.subscribers.get(instanceId).add(callback);\n    console.log(`[Tunnel] Subscribed: ${instanceId}`);\n  }\n  \n  /**\n   * Unsubscribe all callbacks for an instance\n   */\n  unsubscribe(instanceId) {\n    this.subscribers.delete(instanceId);\n    console.log(`[Tunnel] Unsubscribed: ${instanceId}`);\n  }\n  \n  /**\n   * Create tunnel API for a specific instance\n   */\n  createInstanceAPI(instanceId) {\n    return {\n      send: (toInstanceId, message) => {\n        this.send(instanceId, toInstanceId, message);\n      },\n      \n      broadcast: (message) => {\n        this.broadcast(instanceId, message);\n      },\n      \n      onMessage: (callback) => {\n        this.subscribe(instanceId, callback);\n      }\n    };\n  }\n  \n  /**\n   * Get message log for debugging\n   */\n  getMessageLog() {\n    return [...this.messageLog];\n  }\n  \n  /**\n   * Clear message log\n   */\n  clearMessageLog() {\n    this.messageLog = [];\n  }\n}\n\n// Singleton instance\nexport const messageTunnel = new MessageTunnel();\n","/**\n * Instance Manager (Phase 0: Single Instance)\n * \n * Future-proof: Designed to be extended for multi-instance (Phase 1)\n * and transclusion (Phase 2) without breaking changes.\n */\n\nimport { messageTunnel } from './message-tunnel.js';\nimport { unregisterShadowRoot } from '../loader/platform-resources.js';\n\nclass InstanceManager {\n  constructor() {\n    this.instances = new Map();\n    this.compartments = new Map(); // Track SES compartments\n    this.metadata = new Map();\n    this.hierarchy = new Map();\n  }\n  \n  /**\n   * Register a new instance\n   */\n  register(instanceId, instance, metadata = {}) {\n    this.instances.set(instanceId, instance);\n    this.metadata.set(instanceId, {\n      moduleId: metadata.moduleId || null,\n      parentId: metadata.parentId || null,\n      cardId: metadata.cardId || 'card1',\n      rootElement: metadata.rootElement || null,\n      shadowRoot: metadata.shadowRoot || null,  // NEW: Store for cleanup\n      createdAt: Date.now()\n    });\n    \n    if (metadata.parentId) {\n      if (!this.hierarchy.has(metadata.parentId)) {\n        this.hierarchy.set(metadata.parentId, []);\n      }\n      this.hierarchy.get(metadata.parentId).push(instanceId);\n    }\n    \n    console.log('[InstanceManager] Registered:', instanceId);\n  }\n  \n  /**\n   * Get an instance by ID\n   */\n  get(instanceId) {\n    return this.instances.get(instanceId) || null;\n  }\n  \n  /**\n   * Destroy instance and all its children\n   */\n  destroy(instanceId) {\n    const instanceData = this.instances.get(instanceId);\n    \n    if (!instanceData) {\n      console.warn(`[InstanceManager] Instance not found: ${instanceId}`);\n      return;\n    }\n\n    // Get all descendants\n    const descendants = this._getDescendants(instanceId);\n    \n    // Destroy in reverse order (children before parents)\n    const allToDestroy = [...descendants, instanceId].reverse();\n    \n    allToDestroy.forEach(id => {\n      const data = this.instances.get(id);\n      if (data && data.instance && typeof data.instance.destroy === 'function') {\n        try {\n          data.instance.destroy();\n          console.log(`[InstanceManager] Destroyed instance: ${id}`);\n        } catch (error) {\n          console.error(`[InstanceManager] Error destroying ${id}:`, error);\n        }\n      }\n      \n      // Unregister shadow root from Platform Resources\n      const metadata = this.metadata.get(id);\n      if (metadata?.shadowRoot) {\n        unregisterShadowRoot(metadata.shadowRoot);\n      }\n      \n      // Cleanup compartment\n      this.destroyCompartment(id);\n      \n      // Cleanup message tunnel subscriptions\n      messageTunnel.unsubscribe(id);\n      \n      this.instances.delete(id);\n    });\n    \n    console.log(`[InstanceManager] Destroyed: ${instanceId}`);\n  }\n  \n  /**\n   * Get all descendant instance IDs (recursive)\n   */\n  _getDescendants(instanceId) {\n    const descendants = [];\n    const children = this.hierarchy.get(instanceId) || [];\n    \n    children.forEach(childId => {\n      descendants.push(childId);\n      descendants.push(...this._getDescendants(childId));\n    });\n    \n    return descendants;\n  }\n  \n    /**\n   * Generate unique instance ID\n   * Phase 0: card1:moduleId\n   * Phase 1+: card2:moduleId, card1:parent/child\n   */\n  generateInstanceId(moduleId, parentInstanceId = null, cardId = 'card1') {\n    if (!parentInstanceId) {\n      return `${cardId}:${moduleId}`;\n    }\n    \n    const basePath = `${parentInstanceId}/${moduleId}`;\n    let index = 0;\n    let candidateId = basePath;\n    \n    while (this.instances.has(candidateId)) {\n      candidateId = `${basePath}#${index}`;\n      index++;\n    }\n    \n    return candidateId;\n  }\n\n  /**\n   * Register SES compartment for an instance\n   */\n  registerCompartment(instanceId, compartment) {\n    this.compartments.set(instanceId, compartment);\n    console.log(`[InstanceManager] Registered compartment for: ${instanceId}`);\n  }\n\n  /**\n   * Get compartment for an instance\n   */\n  getCompartment(instanceId) {\n    return this.compartments.get(instanceId);\n  }\n\n  /**\n   * Destroy compartment (called during instance cleanup)\n   */\n  destroyCompartment(instanceId) {\n    const compartment = this.compartments.get(instanceId);\n    if (compartment) {\n      // SES compartments don't have explicit destroy, just remove reference\n      this.compartments.delete(instanceId);\n      console.log(`[InstanceManager] Destroyed compartment: ${instanceId}`);\n    }\n  }\n\n  /**\n   * Route message between instances\n   */\n  routeMessage(fromInstanceId, toInstanceId, message) {\n    messageTunnel.send(fromInstanceId, toInstanceId, message);\n  }\n\n  /**\n   * Get instance by ID (for message delivery)\n   */\n  getInstanceById(instanceId) {\n    return this.instances.get(instanceId);\n  }\n\n  /**\n   * Clear all instances\n   */\n  clear() {\n    this.instances.forEach((data, id) => {\n      if (data.instance && typeof data.instance.destroy === 'function') {\n        try {\n          data.instance.destroy();\n        } catch (error) {\n          console.error(`[InstanceManager] Error destroying ${id}:`, error);\n        }\n      }\n      \n      // Cleanup compartment\n      this.destroyCompartment(id);\n      \n      // Cleanup message tunnel\n      messageTunnel.unsubscribe(id);\n    });\n    \n    this.instances.clear();\n    this.compartments.clear();\n    console.log('[InstanceManager] All instances and compartments cleared');\n  }\n}\n\nexport const instanceManager = new InstanceManager();\n","/**\n * DOM Isolation Layer\n * Shadow DOM setup + Proxied document/window APIs\n */\n\nimport { registerShadowRoot, unregisterShadowRoot } from '../loader/platform-resources.js';\n\nexport async function createShadowRoot(container, instanceId) {\n  // Create closed shadow root (maximum isolation)\n  const shadowRoot = container.attachShadow({ mode: 'closed' });\n  \n  // Register with Platform Resources system FIRST\n  // This injects all loaded platform resources (MathJax, FontAwesome, etc.)\n  registerShadowRoot(shadowRoot, instanceId);\n  \n  // Inject theme CSS into shadow root (async - loads CSS files)\n  await injectThemeStyles(shadowRoot);\n  \n  // Create module content container (in shadow root)\n  const contentRoot = document.createElement('div');\n  contentRoot.className = 'module-content';\n  contentRoot.dataset.instanceId = instanceId;\n  shadowRoot.appendChild(contentRoot);\n  \n  return { shadowRoot, contentRoot };\n}\n\n/**\n * Inject theme styles into shadow root\n * Uses <link> tags for browser-native caching and simpler implementation\n */\nexport async function injectThemeStyles(shadowRoot) {\n  // Create style container\n  const styleContainer = document.createElement('div');\n  styleContainer.className = 'shadow-styles';\n  \n  // 1. Load CSS variables (theme colors, spacing, etc.)\n  const variablesLink = document.createElement('link');\n  variablesLink.rel = 'stylesheet';\n  variablesLink.href = './css/styles.css';\n  styleContainer.appendChild(variablesLink);\n  \n  // 2. Load shared module patterns\n  const modulesLink = document.createElement('link');\n  modulesLink.rel = 'stylesheet';\n  modulesLink.href = './css/modules.css';\n  styleContainer.appendChild(modulesLink);\n  \n  // 3. Add base shadow DOM styles inline (critical rendering path)\n  const baseStyles = document.createElement('style');\n  baseStyles.textContent = `\n    /* Base Shadow DOM styles - CRITICAL for proper rendering */\n    :host {\n      display: block;\n      width: 100%;\n      height: 100%;\n      box-sizing: border-box;\n      \n      /* Base typography - matches main document */\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, \"SF Pro Text\", \"Segoe UI\", \"Roboto\", \"Helvetica Neue\", sans-serif;\n      font-size: 16px;\n      line-height: 1.6;\n      \n      /* Text rendering */\n      -webkit-font-smoothing: antialiased;\n      -moz-osx-font-smoothing: grayscale;\n      text-rendering: optimizeLegibility;\n    }\n    \n    /* Module content container inherits theme variables */\n    .module-content {\n      color: var(--text-main);\n      background: transparent;\n      font-family: inherit;\n      font-size: inherit;\n      line-height: inherit;\n      box-sizing: border-box;\n      width: 100%;\n      height: 100%;\n    }\n    \n    /* Ensure all children inherit box-sizing and font properties */\n    .module-content *,\n    .module-content *::before,\n    .module-content *::after {\n      box-sizing: inherit;\n      font-family: inherit;\n    }\n  `;\n  styleContainer.appendChild(baseStyles);\n  \n  // Insert styles at beginning of shadow root\n  shadowRoot.insertBefore(styleContainer, shadowRoot.firstChild);\n  \n  console.log('[DOMIsolation] Injected theme styles via <link> tags (browser-cached)');\n}\n\nexport function createSandboxedDocument(instanceId, shadowRoot) {\n  // DOM node limits (prevents DoS attacks)\n  const MAX_NODES = 10000;  // Maximum nodes per module\n  const WARN_THRESHOLD = 0.8;  // Warn at 80% capacity\n  let nodeCount = 0;\n  let warningSent = false;\n  \n  // Proxied document that restricts access\n  return new Proxy({}, {\n    get(target, prop) {\n      // Allow safe methods scoped to shadow root\n      if (prop === 'querySelector') {\n        return shadowRoot.querySelector.bind(shadowRoot);\n      }\n      if (prop === 'querySelectorAll') {\n        return shadowRoot.querySelectorAll.bind(shadowRoot);\n      }\n      if (prop === 'createElement') {\n        // Return wrapped createElement with node counting\n        return function(tagName) {\n          // Check limit before creating\n          if (nodeCount >= MAX_NODES) {\n            const error = new Error(\n              `[DOMIsolation] DOM node limit exceeded for ${instanceId}. ` +\n              `Maximum ${MAX_NODES} nodes allowed. ` +\n              `This prevents browser DoS attacks.`\n            );\n            console.error(error.message);\n            throw error;\n          }\n          \n          // Increment counter\n          nodeCount++;\n          \n          // Warn at threshold\n          if (!warningSent && nodeCount >= MAX_NODES * WARN_THRESHOLD) {\n            warningSent = true;\n            console.warn(\n              `[DOMIsolation] ${instanceId} has created ${nodeCount} nodes ` +\n              `(${Math.round((nodeCount / MAX_NODES) * 100)}% of limit). ` +\n              `Consider optimizing DOM operations.`\n            );\n          }\n          \n          // Create element\n          return document.createElement.call(document, tagName);\n        };\n      }\n      if (prop === 'createTextNode') {\n        // Text nodes also count toward limit\n        return function(data) {\n          if (nodeCount >= MAX_NODES) {\n            const error = new Error(\n              `[DOMIsolation] DOM node limit exceeded for ${instanceId}`\n            );\n            console.error(error.message);\n            throw error;\n          }\n          \n          nodeCount++;\n          \n          if (!warningSent && nodeCount >= MAX_NODES * WARN_THRESHOLD) {\n            warningSent = true;\n            console.warn(\n              `[DOMIsolation] ${instanceId} approaching node limit: ${nodeCount}/${MAX_NODES}`\n            );\n          }\n          \n          return document.createTextNode.call(document, data);\n        };\n      }\n      if (prop === 'createDocumentFragment') {\n        // Fragments don't count (they're temporary containers)\n        return document.createDocumentFragment.bind(document);\n      }\n      if (prop === 'createComment') {\n        // Comments also count (though rarely abused)\n        return function(data) {\n          if (nodeCount >= MAX_NODES) {\n            const error = new Error(\n              `[DOMIsolation] DOM node limit exceeded for ${instanceId}`\n            );\n            console.error(error.message);\n            throw error;\n          }\n          \n          nodeCount++;\n          return document.createComment.call(document, data);\n        };\n      }\n      \n      // Expose node count for debugging (read-only)\n      if (prop === '__nodeCount') {\n        return nodeCount;\n      }\n      if (prop === '__nodeLimit') {\n        return MAX_NODES;\n      }\n      \n      // Block dangerous operations\n      if (prop === 'body' || prop === 'head' || prop === 'documentElement') {\n        console.warn(`[DOMIsolation] Blocked access to document.${prop} from ${instanceId}`);\n        return null;\n      }\n      \n      console.warn(`[DOMIsolation] Blocked document.${prop} from ${instanceId}`);\n      return undefined;\n    }\n  });\n}\n\nexport function createSandboxedWindow(instanceId) {\n  // Storage for module-specific properties (factory, moduleInfo, etc.)\n  const moduleStorage = {};\n  \n  // Track event listeners for cleanup (stored outside proxy to prevent module access)\n  const eventListeners = new Map();\n  \n  // Proxied window that restricts access\n  return new Proxy(moduleStorage, {\n    get(target, prop) {\n      // Allow safe globals (constructors and objects)\n      const safeGlobals = [\n        'Math', 'JSON', 'Array', 'Object', 'String', 'Number', 'Boolean', \n        'Date', 'RegExp', 'Map', 'Set', 'Promise', 'Error', 'TypeError',\n        'RangeError', 'SyntaxError', 'parseInt', 'parseFloat', 'isNaN',\n        'isFinite', 'decodeURI', 'decodeURIComponent', 'encodeURI',\n        'encodeURIComponent'\n      ];\n      \n      if (safeGlobals.includes(prop)) {\n        return window[prop];\n      }\n      \n      // Allow reading module-registered properties (factory functions, moduleInfo)\n      if (prop in target) {\n        return target[prop];\n      }\n      \n      // Block dangerous operations\n      if (prop === 'document' || prop === 'localStorage' || prop === 'sessionStorage') {\n        console.warn(`[DOMIsolation] Blocked access to window.${prop} from ${instanceId}`);\n        return undefined;\n      }\n      \n      // Allow event-related APIs (with restrictions)\n      if (prop === 'CustomEvent') {\n        // Return constructor, not bound function!\n        return window.CustomEvent;\n      }\n      \n      if (prop === 'Event') {\n        return window.Event;\n      }\n      \n      if (prop === 'addEventListener') {\n        // Return scoped addEventListener\n        return function(eventName, handler, options) {\n          // Define safe global events (browser/UI events only)\n          const safeGlobalEvents = ['resize', 'scroll', 'focus', 'blur'];\n          \n          // Check if event is instance-specific or safe global\n          const isInstanceEvent = eventName.startsWith(instanceId);\n          const isSafeGlobal = safeGlobalEvents.includes(eventName);\n          \n          if (!isInstanceEvent && !isSafeGlobal) {\n            console.warn(\n              `[DOMIsolation] Blocked addEventListener('${eventName}') from ${instanceId}. ` +\n              `Use tunnel API for module communication or prefix with '${instanceId}:'`\n            );\n            return;\n          }\n          \n          // Add listener to real window\n          window.addEventListener(eventName, handler, options);\n          \n          // Track for cleanup on module destroy\n          if (!eventListeners.has(eventName)) {\n            eventListeners.set(eventName, []);\n          }\n          eventListeners.get(eventName).push({ handler, options });\n          \n          console.log(`[DOMIsolation] Allowed addEventListener('${eventName}') from ${instanceId}`);\n        };\n      }\n      \n      if (prop === 'removeEventListener') {\n        // Return scoped removeEventListener\n        return function(eventName, handler, options) {\n          window.removeEventListener(eventName, handler, options);\n          \n          // Remove from tracking\n          if (eventListeners.has(eventName)) {\n            const listeners = eventListeners.get(eventName);\n            const index = listeners.findIndex(l => l.handler === handler);\n            if (index !== -1) {\n              listeners.splice(index, 1);\n            }\n          }\n          \n          console.log(`[DOMIsolation] removeEventListener('${eventName}') from ${instanceId}`);\n        };\n      }\n      \n      if (prop === 'dispatchEvent') {\n        // Return scoped dispatchEvent\n        return function(event) {\n          // Only allow dispatching instance-specific events\n          const isInstanceEvent = event.type.startsWith(instanceId);\n          \n          if (!isInstanceEvent) {\n            console.warn(\n              `[DOMIsolation] Blocked dispatchEvent('${event.type}') from ${instanceId}. ` +\n              `Event type must be prefixed with '${instanceId}:'`\n            );\n            return false;\n          }\n          \n          console.log(`[DOMIsolation] Allowed dispatchEvent('${event.type}') from ${instanceId}`);\n          return window.dispatchEvent(event);\n        };\n      }\n      \n      // Allow __moduleReady callback pattern (legacy modules)\n      if (prop === '__moduleReady' && typeof window.__moduleReady === 'function') {\n        return window.__moduleReady;\n      }\n      \n      console.warn(`[DOMIsolation] Blocked window.${prop} from ${instanceId}`);\n      return undefined;\n    },\n    \n    set(target, prop, value) {\n      // Allow setting factory functions (createModuleName pattern)\n      if (prop.startsWith('create') && typeof value === 'function') {\n        console.log(`[DOMIsolation] Allowed factory registration: window.${prop} from ${instanceId}`);\n        target[prop] = value;\n        return true;\n      }\n      \n      // Allow setting moduleInfo\n      if (prop === 'moduleInfo' && typeof value === 'object') {\n        console.log(`[DOMIsolation] Allowed moduleInfo registration from ${instanceId}`);\n        target[prop] = value;\n        return true;\n      }\n      \n      // Block everything else\n      console.warn(`[DOMIsolation] Blocked setting window.${prop} from ${instanceId}`);\n      return false;\n    }\n  });\n}\n","/**\n * Content loading module\n * Handles loading of modules, pages, and documents\n */\n\nimport { dom, state, themeController } from '../core/state.js';\nimport { scriptUrlFromFile, factoryNameFromId, waitForFactory } from '../core/utils.js';\nimport { autoRender, dynamicRender } from '../loader/index.js';\nimport { instanceManager } from '../core/instance-manager.js';\nimport { createShadowRoot, createSandboxedDocument, createSandboxedWindow } from '../core/dom-isolation.js';\nimport { createSecureCompartment, buildCompartmentGlobals } from '../core/js-isolation.js';\nimport { messageTunnel } from '../core/message-tunnel.js';\n\n/**\n * Detect module layer (Platform vs User)\n * @param {string} filePath - Module file path from tree.json\n * @returns {'PLATFORM'|'USER'}\n */\nfunction getModuleLayer(filePath) {\n  // Normalize path (remove leading ./ if present)\n  const normalized = filePath.replace(/^\\.\\//, '');\n  \n  // User Layer: Home/ directory (user modules)\n  if (normalized.startsWith('Home/')) {\n    return 'USER';\n  }\n  \n  // User Layer: javascript/user/ (user utilities)\n  if (normalized.startsWith('javascript/user/')) {\n    return 'USER';\n  }\n  \n  // Platform Layer: Everything else\n  // Note: Platform modules (javascript/modules/*) are statically imported in app.js\n  // They should NEVER appear in tree.json or be loaded via content-loader\n  return 'PLATFORM';\n}\n\n/**\n * Clear active module instance\n */\nexport function clearActiveInstance() {\n  if (state.activeInstance && typeof state.activeInstance.destroy === \"function\") {\n    try {\n      const instanceId = state.activeNode \n        ? instanceManager.generateInstanceId(state.activeNode.id, null, 'card1')\n        : null;\n      \n      if (instanceId) {\n        instanceManager.destroy(instanceId);\n      } else {\n        state.activeInstance.destroy();\n      }\n    } catch (e) {\n      console.error('[ContentLoader] Failed to destroy instance:', e);\n    }\n  }\n  state.activeInstance = null;\n}\n\n/**\n * Fetch module code as text (for compartment evaluation)\n * Service worker will cache this automatically in PWA mode\n */\nexport async function fetchModuleCode(src) {\n  console.log('[ContentLoader] Fetching module as text:', src);\n  \n  const response = await fetch(src);\n  if (!response.ok) {\n    throw new Error(`Failed to fetch module: ${response.status} ${response.statusText}`);\n  }\n  \n  const code = await response.text();\n  console.log('[ContentLoader] Fetched', code.length, 'bytes');\n  \n  return code;\n}\n\n/**\n * Get factory function for a module by evaluating in compartment\n * Returns { factory, moduleCode } to avoid re-fetching\n */\nexport async function getFactoryForModule(node, compartment) {\n  const scriptSrc = scriptUrlFromFile(node.file);\n  const factoryName = factoryNameFromId(node.id);\n\n  // Fetch module code as text (service worker caches this in PWA!)\n  const moduleCode = await fetchModuleCode(scriptSrc);\n  \n  // Evaluate code inside compartment (compiled with sandboxed globals)\n  try {\n    compartment.evaluate(moduleCode);\n    console.log('[ContentLoader] Evaluated module code in compartment');\n  } catch (error) {\n    console.error('[ContentLoader] Failed to evaluate module code:', error);\n    throw new Error(`Module evaluation failed for ${node.id}: ${error.message}`);\n  }\n  \n  // Get factory from compartment's window (modules register on window.createModuleName)\n  const factory = compartment.globalThis.window[factoryName];\n  \n  if (typeof factory !== \"function\") {\n    console.error('[ContentLoader] Factory lookup failed. Available on window:', Object.keys(compartment.globalThis.window || {}));\n    throw new Error(\n      `Factory ${factoryName} not found or not a function in compartment for module ${node.id}`\n    );\n  }\n  \n  console.log('[ContentLoader] Factory extracted from compartment:', factoryName);\n  \n  return { factory, moduleCode };\n}\n\n/**\n * Load a module (interactive tool/calculator)\n * Note: Shared CSS patterns loaded via modules.css in index.html\n * Module-specific styles are inlined in each module's JS file\n */\nexport async function loadModule(node, done) {\n  // Detect module layer for logging and future extensibility\n  const moduleLayer = getModuleLayer(node.file);\n  console.log('[ContentLoader] Loading module:', node.id, '| Layer:', moduleLayer, '| File:', node.file);\n  \n  // Validation: Only USER layer modules should be loaded via content-loader\n  if (moduleLayer === 'PLATFORM') {\n    console.error('[ContentLoader] ERROR: Platform modules should not be in navigation tree!');\n    console.error('[ContentLoader] Platform modules must be statically imported in app.js');\n    console.error('[ContentLoader] Attempted to load:', node.file);\n    dom.card.innerHTML = \"\\n\\nConfiguration Error: Platform module in navigation tree.\";\n    dom.card.classList.remove(\"preload\");\n    dom.card.classList.add(\"loaded\");\n    done(null);\n    return;\n  }\n  \n  // All modules loaded here are USER layer (apply isolation)\n  console.log('[ContentLoader] Applying USER LAYER isolation (SES + Shadow DOM)');\n  \n  // Create instance ID first\n  const instanceId = instanceManager.generateInstanceId(node.id, null, 'card1');\n  \n  // Create shadow root container\n  const container = document.createElement(\"div\");\n  container.className = \"module-container\";\n  container.dataset.instanceId = instanceId;\n  dom.card.appendChild(container);\n  \n  // Create isolated shadow DOM (Platform Resources auto-inject)\n  const { shadowRoot, contentRoot } = await createShadowRoot(container, instanceId);\n  \n  // Create sandboxed APIs\n  const sandboxedDocument = createSandboxedDocument(instanceId, shadowRoot);\n  const sandboxedWindow = createSandboxedWindow(instanceId);\n  const tunnel = messageTunnel.createInstanceAPI(instanceId);\n  \n  // Create secure compartment with sandboxed globals (no factory/options yet!)\n  const compartmentGlobals = buildCompartmentGlobals(\n    instanceId,\n    sandboxedDocument,\n    sandboxedWindow,\n    tunnel,\n    themeController,\n    dynamicRender,\n  );\n  \n  const compartment = createSecureCompartment(instanceId, compartmentGlobals);\n  instanceManager.registerCompartment(instanceId, compartment);\n\n  // Fetch and evaluate module code in compartment\n  getFactoryForModule(node, compartment)\n    .then(({ factory }) => {\n      // Create options object\n      const options = {\n        root: contentRoot,        // Shadow DOM root (for module UI)\n        themeController: themeController,\n        dynamicRender: dynamicRender,\n        instanceId: instanceId,\n        parentInstanceId: null,\n        tunnel: tunnel\n      };\n\n      let instance = null;\n      try {\n        console.log('[ContentLoader] Creating module instance from compartment factory:', instanceId);\n        \n        // Add options to compartment globals\n        compartment.globalThis.__options = options;\n        \n        // Call factory INSIDE compartment (correct context for DOM methods!)\n        const factoryName = factoryNameFromId(node.id);\n        instance = compartment.evaluate(`window.${factoryName}(__options)`) || {};\n        \n      } catch (err) {\n        console.error('[ContentLoader] Module instantiation failed:', err);\n        dom.card.innerHTML = \"\\n\\nUnable to load module.\";\n        dom.card.classList.remove(\"preload\");\n        dom.card.classList.add(\"loaded\");\n        done(null);\n        return;\n      }\n\n      requestAnimationFrame(async () => { \n        // Shadow DOM handles CSS isolation automatically\n        // No need for scopeModuleStyles()\n        \n        await autoRender(contentRoot);\n        dom.card.classList.remove(\"preload\");\n        dom.card.classList.add(\"loaded\");\n        \n        console.log('[ContentLoader] Module loaded successfully in isolated environment:', instanceId);\n      });\n\n      instanceManager.register(instanceId, instance, {\n        moduleId: node.id,\n        parentId: null,\n        cardId: 'card1',\n        rootElement: contentRoot,\n        shadowRoot: shadowRoot,\n        container: container\n      });\n\n      done(instance);\n    })\n    .catch((err) => {\n      console.error('[ContentLoader] Module loading failed:', err);\n      dom.card.innerHTML = \"\\n\\nUnable to load module.\";\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done(null);\n    });\n}\n\n/**\n * Load a page (static HTML content)\n */\nexport function loadPage(node, done) {\n  const url = scriptUrlFromFile(node.file);\n  fetch(url)\n    .then((res) => {\n      if (!res.ok) throw new Error(\"Failed to load page: \" + url);\n      return res.text();\n    })\n    .then((html) => {\n      dom.card.innerHTML = html;\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done({});\n    })\n    .catch((err) => {\n      console.error(err);\n      dom.card.innerHTML = \"\\n\\nUnable to load page.\";\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done(null);\n    });\n}\n\n/**\n * Load a document (text/markdown content)\n */\nexport function loadDocument(node, done) {\n  const url = scriptUrlFromFile(node.file);\n  fetch(url)\n    .then((res) => {\n      if (!res.ok) throw new Error(\"Failed to load document: \" + url);\n      return res.text();\n    })\n    .then((md) => {\n      const inner = document.createElement(\"div\");\n      inner.className = \"document-root\";\n      const pre = document.createElement(\"pre\");\n      pre.textContent = md;\n      inner.appendChild(pre);\n      dom.card.appendChild(inner);\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done({});\n    })\n    .catch((err) => {\n      console.error(err);\n      dom.card.innerHTML = \"\\n\\nUnable to load document.\";\n      dom.card.classList.remove(\"preload\");\n      dom.card.classList.add(\"loaded\");\n      done(null);\n    });\n}\n\n/**\n * Open a node (module/page/document)\n */\nexport function openNode(node) {\n  if (!node) return;\n\n  clearActiveInstance();\n\n  dom.card.classList.remove(\"loaded\");\n  dom.card.classList.add(\"preload\");\n  dom.card.innerHTML = \"\";\n\n  const type = node.type;\n\n  if (type === \"module\") {\n    loadModule(node, (instance) => {\n      state.activeInstance = instance || {};\n      state.activeNode = node;\n    });\n  } else if (type === \"page\") {\n    loadPage(node, (instance) => {\n      state.activeInstance = instance || {};\n      state.activeNode = node;\n    });\n  } else if (type === \"document\") {\n    loadDocument(node, (instance) => {\n      state.activeInstance = instance || {};\n      state.activeNode = node;\n    });\n  } else {\n    dom.card.classList.remove(\"preload\");\n    dom.card.classList.add(\"loaded\");\n    state.activeInstance = {};\n    state.activeNode = node;\n  }\n}","/**\n * JavaScript Isolation Layer\n * SES Compartment wrapper for secure module execution\n */\n\nexport function createSecureCompartment(instanceId, globalOverrides = {}) {\n  const compartment = new Compartment(globalOverrides);\n  \n  console.log(`[JSIsolation] Created secure compartment for ${instanceId}`);\n  \n  return compartment;\n}\n\nexport function evaluateModuleFactory(compartment, factoryName) {\n  // Module already loaded in global scope, get reference\n  try {\n    // Evaluate code that returns the factory from window\n    const factory = compartment.evaluate(`\n      (function() {\n        if (typeof window !== 'undefined' && typeof window.${factoryName} === 'function') {\n          return window.${factoryName};\n        }\n        throw new Error('Factory ${factoryName} not found');\n      })()\n    `);\n    \n    return factory;\n  } catch (error) {\n    console.error(`[JSIsolation] Failed to evaluate factory ${factoryName}:`, error);\n    throw error;\n  }\n}\n\nexport function buildCompartmentGlobals(instanceId, sandboxedDocument, sandboxedWindow, tunnel, themeController, dynamicRender) {\n  return {\n    // Sandboxed globals\n    document: sandboxedDocument,\n    window: sandboxedWindow,\n    \n    // Safe globals (hardened by lockdown())\n    console: console,\n    Math: Math,\n    JSON: JSON,\n    Array: Array,\n    Object: Object,\n    String: String,\n    Number: Number,\n    Boolean: Boolean,\n    Date: Date,\n    RegExp: RegExp,\n    Map: Map,\n    Set: Set,\n    Promise: Promise,\n    Error: Error,\n    TypeError: TypeError,\n    RangeError: RangeError,\n    SyntaxError: SyntaxError,\n    \n    // Event constructors (needed for modules that dispatch events)\n    CustomEvent: CustomEvent,\n    Event: Event,\n    \n    // Utility functions\n    parseInt: parseInt,\n    parseFloat: parseFloat,\n    isNaN: isNaN,\n    isFinite: isFinite,\n    \n    // Animation frame (for rendering, NOT logic timing - allowed by project rules)\n    requestAnimationFrame: requestAnimationFrame.bind(window),\n    cancelAnimationFrame: cancelAnimationFrame.bind(window),\n    \n    // Utilities provided by app (HARDENED to prevent prototype pollution)\n    tunnel: harden(tunnel),\n    themeController: harden(themeController),\n    dynamicRender: harden(dynamicRender),\n    \n    // Block dangerous globals\n    eval: undefined,\n    Function: undefined,\n    setTimeout: undefined,  // Enforce no setTimeout (your rule)\n    setInterval: undefined,  // Enforce no setInterval (your rule)\n    \n    // Block network access (prevents data exfiltration)\n    fetch: undefined,\n    XMLHttpRequest: undefined,\n    \n    // Block DOM observers (prevents parent DOM spying)\n    MutationObserver: undefined,\n    IntersectionObserver: undefined,\n    ResizeObserver: undefined\n  };\n}\n","/**\n * Navigation module\n * Handles breadcrumb and sidebar navigation rendering\n */\n\nimport { dom, state } from '../core/state.js';\nimport { findNodeByPath, findLeafById } from '../core/utils.js';\nimport { clearSidebarActive, applySidebarWidth, toggleSidebar } from './sidebar.js';\nimport { openNode } from './content-loader.js';\nimport { isDesktopOrTablet } from '../core/utils.js';\nimport { loadFontAwesome, getTypeIcon } from '../loader/fontawesome-loader.js'; \n\n// Track if icons have been loaded for navigation\nlet iconsLoaded = false;\n\n/**\n * Ensure FontAwesome is loaded before rendering navigation icons\n */\nasync function ensureIconsLoaded() {\n  if (iconsLoaded) return;\n  \n  console.log('[Navigation] Loading FontAwesome icons');\n  await loadFontAwesome();\n  iconsLoaded = true;\n}\n\n/**\n * Check if in landscape mode\n */\nfunction isLandscapeMode() {\n  return window.matchMedia('(max-height: 600px) and (orientation: landscape)').matches;\n}\n\n/**\n * Render breadcrumb navigation\n */\nexport function renderBreadcrumb() {\n  if (!state.navigationTree || !state.currentFolder) return;\n  if (!dom.sidebarBreadcrumb) return;\n\n  dom.sidebarBreadcrumb.innerHTML = \"\";\n\n  const fullPath = state.currentFolder.path || \"Home\";\n  const segments = fullPath.split(\"/\");\n\n  segments.forEach((segment, index) => {\n    const isLast = index === segments.length - 1;\n    const path = segments.slice(0, index + 1).join(\"/\");\n\n    const part = document.createElement(\"span\");\n    part.textContent = segment;\n    part.className = \"sidebar-breadcrumb-part\" + (isLast ? \" current\" : \"\");\n\n    if (!isLast) {\n      part.addEventListener(\"click\", () => {\n        if (path === state.currentFolder.path) return;\n        const node = findNodeByPath(state.navigationTree, path);\n        if (!node || node.type !== \"folder\") return;\n\n        navigateToFolder(node);\n      });\n    }\n\n    dom.sidebarBreadcrumb.appendChild(part);\n\n    if (!isLast) {\n      const sep = document.createElement(\"span\");\n      sep.textContent = \"/\";\n      sep.className = \"sidebar-breadcrumb-separator\";\n      dom.sidebarBreadcrumb.appendChild(sep);\n    }\n  });\n}\n\n/**\n * Navigate to a folder - unified function for all folder navigation\n * This triggers all necessary actions: render sidebar, preload, calculate width\n */\nexport async function navigateToFolder(folderNode) { \n  console.log('[Navigation] Navigating to folder:', folderNode.path || 'Home');\n  await renderSidebar(folderNode); \n  window.dispatchEvent(new CustomEvent('folderNavigated', {\n    detail: { folderNode }\n  }));\n}\n\nexport async function renderSidebar(folderNode) {\n  console.log('[Navigation] Rendering sidebar for folder:', folderNode.path || 'Home');\n  \n  // Only load icons if sidebar content is initialized (user has opened sidebar)\n  // This prevents loading FontAwesome on initial page load\n  if (typeof window !== 'undefined') { \n    const sidebarModule = await import('./sidebar.js');\n    if (sidebarModule.isSidebarContentInitialized && sidebarModule.isSidebarContentInitialized()) {\n      await ensureIconsLoaded();\n    }\n  }\n  \n  state.currentFolder = folderNode;\n  dom.sidebarNav.innerHTML = \"\";\n\n  renderBreadcrumb();\n\n  const items = [];\n\n  // Add \"Back\" button if not at root\n  if (folderNode !== state.navigationTree) {\n    const parentPath = folderNode.path.split(\"/\").slice(0, -1).join(\"/\");\n    const parentNode = findNodeByPath(state.navigationTree, parentPath);\n    if (parentNode) {\n      const upItem = document.createElement(\"button\");\n      upItem.type = \"button\";\n      upItem.className = \"nav-item\";\n      upItem.setAttribute(\"data-type\", \"folder\");\n      upItem.setAttribute(\"data-path\", parentNode.path);\n      upItem.innerHTML = `\n        <span class=\"nav-index\"></span>\n        <span class=\"nav-icon\">${getTypeIcon(\"back\")}</span>\n        <span class=\"nav-label\">Back</span>\n      `;\n      items.push(upItem);\n    }\n  }\n\n  // Add folder children\n  if (folderNode.children) {\n    folderNode.children.forEach((child, index) => {\n      const btn = document.createElement(\"button\");\n      btn.type = \"button\";\n      btn.className = \"nav-item\";\n\n      if (child.type === \"folder\") {\n        btn.setAttribute(\"data-type\", \"folder\");\n        btn.setAttribute(\"data-path\", child.path);\n        btn.innerHTML = `\n          <span class=\"nav-index\">${String(index + 1).padStart(2, \"0\")}</span>\n          <span class=\"nav-icon\">${getTypeIcon(\"folder\")}</span>\n          <span class=\"nav-label\">${child.name}</span>\n        `;\n      } else {\n        // module, page, document\n        btn.setAttribute(\"data-type\", child.type);\n        btn.setAttribute(\"data-id\", child.id);\n        const label =\n          state.moduleDisplayNames[child.id] ||\n          child.title ||\n          child.id ||\n          \"Loading\";\n        btn.innerHTML = `\n          <span class=\"nav-index\">${String(index + 1).padStart(2, \"0\")}</span>\n          <span class=\"nav-icon\">${getTypeIcon(child.type)}</span>\n          <span class=\"nav-label\">${label}</span>\n        `;\n\n        if (state.activeNode && state.activeNode.id === child.id) {\n          btn.classList.add(\"active\");\n        }\n      }\n\n      items.push(btn);\n    });\n  }\n\n  items.forEach((btn) => dom.sidebarNav.appendChild(btn));\n\n  // Add click event listeners\n  dom.sidebarNav.querySelectorAll(\".nav-item\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => {\n      const type = btn.getAttribute(\"data-type\");\n\n      if (type === \"folder\") {\n        const path = btn.getAttribute(\"data-path\");\n        if (!path) return;\n        const node = findNodeByPath(state.navigationTree, path);\n        if (!node) return;\n\n        navigateToFolder(node);\n        return;\n      }\n\n      if (type === \"module\" || type === \"page\" || type === \"document\") {\n        const id = btn.getAttribute(\"data-id\");\n        if (!id) return;\n        const node = findLeafById(state.navigationTree, id);\n        if (!node) return;\n\n        clearSidebarActive();\n        btn.classList.add(\"active\");\n        openNode(node);\n\n        if (!isDesktopOrTablet() || isLandscapeMode()) {\n          toggleSidebar();\n        }\n      }\n    });\n  });\n\n  // Apply cached width (no measurement needed!)\n  console.log('[Navigation] Applying cached width values');\n  applySidebarWidth();\n}","/**\n * Module preloading system\n * Preloads modules in a folder for better performance\n * Calculates sidebar width from JSON metadata using actual DOM measurement\n */\n\nimport { state, themeController } from '../core/state.js';\nimport { scriptUrlFromFile, factoryNameFromId, extractDisplayNameFromCode } from '../core/utils.js';\nimport { dynamicRender } from '../loader/index.js';\nimport { instanceManager } from '../core/instance-manager.js';\nimport { createShadowRoot, createSandboxedDocument, createSandboxedWindow } from '../core/dom-isolation.js';\nimport { createSecureCompartment, buildCompartmentGlobals } from '../core/js-isolation.js';\nimport { messageTunnel } from '../core/message-tunnel.js';\n\n/**\n * Measure actual width needed for label texts using temporary DOM element\n * This ensures accurate measurement matching real CSS\n */\nfunction measureLabelsWidth(labelTexts) {\n  if (labelTexts.length === 0) return 240;\n\n  // Create temporary hidden container\n  const tempContainer = document.createElement('div');\n  tempContainer.style.position = 'absolute';\n  tempContainer.style.left = '-99999px';\n  tempContainer.style.top = '-99999px';\n  tempContainer.style.visibility = 'hidden';\n  tempContainer.style.pointerEvents = 'none';\n  document.body.appendChild(tempContainer);\n\n  let maxLabelWidth = 0;\n\n  labelTexts.forEach(text => {\n    // Create element with exact same styles as real nav-label\n    const label = document.createElement('span');\n    label.className = 'nav-label';\n    label.textContent = text;\n    \n    // Apply critical styles that affect width measurement\n    label.style.fontSize = '1.2rem';\n    label.style.lineHeight = '1.1';\n    label.style.whiteSpace = 'nowrap';\n    label.style.display = 'inline-block';\n    \n    tempContainer.appendChild(label);\n\n    // Force reflow to ensure accurate measurement\n    void label.offsetWidth;\n\n    const width = label.getBoundingClientRect().width;\n    \n    if (width > maxLabelWidth) {\n      maxLabelWidth = width;\n    }\n\n    tempContainer.removeChild(label);\n  });\n\n  document.body.removeChild(tempContainer);\n\n  // Calculate total needed width using your formula:\n  const navIndexWidth = 24;      // \"01\", \"02\" etc\n  const navIconWidth = 24;       // icon + margins\n  const padding = 12;            // sidebar padding\n  const extraMargin = 40;        // safety margin\n  \n  const totalNeeded = navIndexWidth + navIconWidth + maxLabelWidth + padding + extraMargin;\n  \n  console.log('[Preloader] Width measurement:', {\n    maxLabelWidth: Math.ceil(maxLabelWidth),\n    navIndexWidth: navIndexWidth,\n    navIconWidth: navIconWidth,\n    padding: padding,\n    extraMargin: extraMargin,\n    totalNeeded: Math.ceil(totalNeeded)\n  });\n\n  return Math.ceil(totalNeeded);\n}\n\n/**\n * Calculate sidebar width for a folder from JSON metadata\n * Measures actual rendered width using temporary DOM element\n */\nfunction calculateFolderWidth(folderNode) {\n  if (!folderNode || !folderNode.children) return { width: 240, hoverNeeded: false };\n\n  const labelTexts = folderNode.children\n    .map(child => {\n      if (child.type === 'folder') {\n        return child.name || '';\n      } else if (child.type === 'module' || child.type === 'page' || child.type === 'document') {\n        return child.title || child.id || '';\n      }\n      return '';\n    })\n    .filter(text => text.length > 0);\n\n  const width = measureLabelsWidth(labelTexts);\n  const hoverNeeded = width > state.baseSidebarWidth;\n\n  return { width, hoverNeeded };\n}\n\n/**\n * Preload modules in a folder for better performance\n * Width calculation is instant using JSON titles\n */\nexport function preloadFolderModules(folderNode) {\n  if (!folderNode || !folderNode.children) return;\n\n  const folderPath = folderNode.path || 'Home';\n\n  // Calculate and cache width immediately from JSON\n  if (!state.folderWidthCache.has(folderPath)) {\n    const { width, hoverNeeded } = calculateFolderWidth(folderNode);\n    \n    state.folderWidthCache.set(folderPath, { width, hoverNeeded });\n    state.hoverSidebarWidth = width;\n    state.hoverNeeded = hoverNeeded;\n    \n    console.log('[Preloader] Calculated and cached width for', folderPath, ':', {\n      width: width,\n      hoverNeeded: hoverNeeded\n    });\n  } else {\n    const cachedWidth = state.folderWidthCache.get(folderPath);\n    state.hoverSidebarWidth = cachedWidth.width;\n    state.hoverNeeded = cachedWidth.hoverNeeded;\n    console.log('[Preloader] Using cached width for', folderPath);\n  }\n\n  window.dispatchEvent(new CustomEvent('sidebarRenderNeeded', {\n    detail: { folderNode }\n  }));\n  \n  window.dispatchEvent(new CustomEvent('searchIndexRebuildNeeded'));\n\n  // Now preload modules in background (for faster loading when clicked)\n  const modulesToPreload = folderNode.children.filter(\n    (child) => child.type === \"module\" && !state.preloadedModules.has(child.id)\n  );\n  \n  if (modulesToPreload.length === 0) {\n    console.log('[Preloader] No modules to preload for', folderPath);\n    return;\n  }\n\n  console.log('[Preloader] Starting background preload of', modulesToPreload.length, 'modules');\n\n  function preloadNext(index) {\n    if (index >= modulesToPreload.length) {\n      console.log('[Preloader] All modules preloaded');\n      return;\n    }\n\n    const mod = modulesToPreload[index];\n    const scriptSrc = scriptUrlFromFile(mod.file);\n\n    if (state.loadedScripts.has(scriptSrc)) {\n      state.preloadedModules.add(mod.id);\n      if (window.requestIdleCallback) {\n        requestIdleCallback(() => preloadNext(index + 1));\n      } else {\n        Promise.resolve().then(() => preloadNext(index + 1));\n      }\n      return;\n    }\n\n    console.log('[Preloader] Loading module', index + 1, '/', modulesToPreload.length, ':', mod.id);\n\n    // Fetch module code as text (service worker caches this!)\n    fetch(scriptSrc)\n      .then(response => {\n        if (!response.ok) {\n          throw new Error(`Failed to fetch: ${response.status}`);\n        }\n        return response.text();\n      })\n      .then(async (moduleCode) => {\n        state.loadedScripts.add(scriptSrc);\n        \n        // Extract display name from code WITHOUT executing\n        const displayName = extractDisplayNameFromCode(moduleCode);\n        if (displayName) {\n          state.moduleDisplayNames[mod.id] = displayName;\n          console.log('[Preloader] Extracted display name for', mod.id, ':', displayName);\n        }\n        \n        state.preloadedModules.add(mod.id);\n        \n        // Continue to next module\n        if (window.requestIdleCallback) {\n          requestIdleCallback(() => preloadNext(index + 1));\n        } else {\n          Promise.resolve().then(() => preloadNext(index + 1));\n        }\n      })\n      .catch(error => {\n        console.error('[Preloader] Failed to preload module:', scriptSrc, error);\n        state.preloadedModules.add(mod.id);\n        \n        if (window.requestIdleCallback) {\n          requestIdleCallback(() => preloadNext(index + 1));\n        } else {\n          Promise.resolve().then(() => preloadNext(index + 1));\n        }\n      });\n  }\n\n  preloadNext(0);\n}\n\n/**\n * Get initial folder on page load\n */\nexport function getInitialFolder(tree) {\n  return tree;\n}\n\n/**\n * Initialize preloader event listeners\n * Call this from app.js after all modules are loaded\n */\nexport function initPreloader() {\n  // Listen for folder navigation events\n  window.addEventListener('folderNavigated', (event) => {\n    const { folderNode } = event.detail;\n    console.log('[Preloader] Received folderNavigated event');\n    preloadFolderModules(folderNode);\n  });\n  \n  console.log('[Preloader] Event listeners initialized');\n}","/**\n * Search functionality module\n * Handles search indexing, querying, and results display\n */\n\nimport { dom, state } from '../core/state.js';\nimport { findNodeByPath, findParentFolder, isDesktopOrTablet } from '../core/utils.js';\nimport { getTypeIcon } from '../loader/fontawesome-loader.js';\nimport { navigateToFolder } from './navigation.js';\nimport { clearSidebarActive, toggleSidebar } from './sidebar.js';\nimport { openNode } from './content-loader.js';\n\n/**\n * Build searchable index from navigation tree\n */\nexport function buildSearchIndex(node, pathArray = [], parentNode = null) {\n  const index = [];\n\n  if (!node) return index;\n\n  const currentPath = pathArray.length > 0 ? pathArray.join(\" > \") : \"\";\n\n  // Index folders\n  if (node.type === \"folder\" && node.name) {\n    index.push({\n      type: \"folder\",\n      name: node.name,\n      path: node.path,\n      displayPath: currentPath,\n      searchText: node.name.toLowerCase(),\n      node: node,\n      parentNode: parentNode\n    });\n  }\n\n  // Index modules, pages, documents\n  if (node.type === \"module\" || node.type === \"page\" || node.type === \"document\") {\n    const title = state.moduleDisplayNames[node.id] || node.title || node.id || \"\";\n    const tags = (node.tags || []).join(\" \").toLowerCase();\n\n    index.push({\n      type: node.type,\n      id: node.id,\n      title: title,\n      path: node.path,\n      displayPath: currentPath,\n      searchText: (title + \" \" + tags).toLowerCase(),\n      node: node,\n      parentNode: parentNode\n    });\n  }\n\n  // Recursively index children\n  if (node.children && node.children.length > 0) {\n    const newPath = node.name ? [...pathArray, node.name] : pathArray;\n    node.children.forEach(child => {\n      index.push(...buildSearchIndex(child, newPath, node));\n    });\n  }\n\n  return index;\n}\n\n/**\n * Rebuild the search index\n */\nexport function rebuildSearchIndex() {\n  if (!state.navigationTree) return;\n  state.searchIndex = buildSearchIndex(state.navigationTree);\n  console.log('[Search] Index rebuilt with', state.searchIndex.length, 'items');\n}\n\n/**\n * Score a search match\n */\nfunction scoreMatch(searchText, query) {\n  const lowerQuery = query.toLowerCase();\n  const lowerText = searchText.toLowerCase();\n\n  // Exact match gets highest score\n  if (lowerText === lowerQuery) return 1000;\n\n  // Starts with query\n  if (lowerText.startsWith(lowerQuery)) return 500;\n\n  // Contains query as whole word\n  const words = lowerText.split(/\\s+/);\n  for (const word of words) {\n    if (word.startsWith(lowerQuery)) return 300;\n    if (word.includes(lowerQuery)) return 150;\n  }\n\n  // Contains query anywhere (substring match)\n  if (lowerText.includes(lowerQuery)) return 100;\n\n  return 0;\n}\n\n/**\n * Search items in the index\n */\nfunction searchItems(query) {\n  if (!query || query.trim().length < 2) return [];\n\n  const trimmedQuery = query.trim();\n  const results = [];\n\n  state.searchIndex.forEach(item => {\n    const score = scoreMatch(item.searchText, trimmedQuery);\n    if (score > 0) {\n      results.push({ ...item, score });\n    }\n  });\n\n  // Sort by score (highest first), then alphabetically\n  results.sort((a, b) => {\n    if (b.score !== a.score) return b.score - a.score;\n    const aName = a.title || a.name || \"\";\n    const bName = b.title || b.name || \"\";\n    return aName.localeCompare(bName);\n  });\n\n  return results.slice(0, 15);\n}\n\n/**\n * Highlight matching text in search results\n */\nfunction highlightMatch(text, query) {\n  if (!query || !text) return text;\n\n  const lowerText = text.toLowerCase();\n  const lowerQuery = query.toLowerCase();\n  const index = lowerText.indexOf(lowerQuery);\n\n  if (index === -1) return text;\n\n  const before = text.substring(0, index);\n  const match = text.substring(index, index + query.length);\n  const after = text.substring(index + query.length);\n\n  return before + '<span class=\"search-match\">' + match + '</span>' + after;\n}\n\n/**\n * Render search results\n */\nfunction renderSearchResults(results, query) {\n  state.selectedResultIndex = -1;\n\n  if (results.length === 0) {\n    dom.searchResults.innerHTML = '<div class=\"search-no-results\">No results found</div>';\n    dom.searchResults.style.display = \"block\";\n    return;\n  }\n\n  const html = results.map((item, index) => {\n    const displayName = item.title || item.name || \"\";\n    const highlightedName = highlightMatch(displayName, query);\n    const icon = getTypeIcon(item.type);\n\n    return `\n      <div class=\"search-result-item\" data-index=\"${index}\">\n        <div class=\"search-result-title\">\n          <span class=\"search-result-icon\">${icon}</span>\n          <span>${highlightedName}</span>\n        </div>\n        ${item.displayPath ? `<div class=\"search-result-path\">${item.displayPath}</div>` : \"\"}\n      </div>\n    `;\n  }).join(\"\");\n\n  dom.searchResults.innerHTML = html;\n  dom.searchResults.style.display = \"block\";\n\n  // Add click listeners\n  dom.searchResults.querySelectorAll(\".search-result-item\").forEach((el, index) => {\n    el.addEventListener(\"click\", () => {\n      handleResultSelection(results[index]);\n    });\n  });\n}\n\n/**\n * Handle selection of a search result\n */\nfunction handleResultSelection(item) {\n  console.log('[Search] Selected item:', item);\n  \n  if (!item || !item.node) {\n    console.error('[Search] Invalid item or node');\n    return;\n  }\n\n  if (item.type === \"folder\") {\n    // Navigate to folder using unified function\n    console.log('[Search] Navigating to folder:', item.node.path);\n    navigateToFolder(item.node);\n  } else {\n    // For modules/pages/documents - use stored parent from index\n    let parentNode = item.parentNode;\n    \n    console.log('[Search] Item details:', {\n      itemType: item.type,\n      itemPath: item.path,\n      itemNode: item.node,\n      parentNode: parentNode\n    });\n\n    if (parentNode && parentNode.type === 'folder') {\n      console.log('[Search] Navigating to parent folder:', parentNode.path || 'Home');\n      \n      // Navigate to parent folder (triggers all folder navigation actions)\n      navigateToFolder(parentNode);\n      \n      // Wait for folder navigation to complete, then open the item\n      requestAnimationFrame(() => {\n        console.log('[Search] Opening item:', item.node.id);\n        clearSidebarActive();\n        openNode(item.node);\n\n        // Highlight the active item in sidebar after opening\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            const navItem = dom.sidebarNav.querySelector(\n              '.nav-item[data-type=\"' + item.node.type + '\"][data-id=\"' + item.node.id + '\"]'\n            );\n            if (navItem) {\n              navItem.classList.add(\"active\");\n              console.log('[Search] Activated nav item');\n            } else {\n              console.warn('[Search] Could not find nav item for', item.node.id);\n            }\n          });\n        });\n      });\n    } else {\n      console.error('[Search] Could not find valid parent folder');\n    }\n  }\n\n  // Clear search UI\n  dom.searchInput.value = \"\";\n  dom.searchClear.style.display = \"none\";\n  dom.searchResults.style.display = \"none\";\n  dom.searchResults.innerHTML = \"\";\n\n  // Close sidebar on mobile\n  if (!isDesktopOrTablet()) {\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => toggleSidebar());\n    });\n  }\n}\n\n/**\n * Update selected result with keyboard navigation\n */\nfunction updateSelectedResult(direction) {\n  const items = dom.searchResults.querySelectorAll(\".search-result-item\");\n  if (items.length === 0) return;\n\n  // Remove previous selection\n  if (state.selectedResultIndex >= 0 && state.selectedResultIndex < items.length) {\n    items[state.selectedResultIndex].classList.remove(\"selected\");\n  }\n\n  // Update index\n  if (direction === \"down\") {\n    state.selectedResultIndex = (state.selectedResultIndex + 1) % items.length;\n  } else if (direction === \"up\") {\n    state.selectedResultIndex = state.selectedResultIndex <= 0 ? items.length - 1 : state.selectedResultIndex - 1;\n  }\n\n  // Add new selection\n  if (state.selectedResultIndex >= 0 && state.selectedResultIndex < items.length) {\n    items[state.selectedResultIndex].classList.add(\"selected\");\n    items[state.selectedResultIndex].scrollIntoView({ block: \"nearest\" });\n  }\n}\n\n/**\n * Initialize search functionality\n */\nexport function initSearch() {\n  let searchDebounceTimer = null;\n\n  dom.searchInput.addEventListener(\"input\", (e) => {\n    const query = e.target.value;\n\n    // Show/hide clear button\n    dom.searchClear.style.display = query.length > 0 ? \"flex\" : \"none\";\n\n    // Debounce search\n    clearTimeout(searchDebounceTimer);\n\n    if (query.trim().length === 0) {\n      dom.searchResults.style.display = \"none\";\n      dom.searchResults.innerHTML = \"\";\n      return;\n    }\n\n    searchDebounceTimer = setTimeout(() => {\n      const results = searchItems(query);\n      renderSearchResults(results, query);\n    }, 200);\n  });\n\n  dom.searchInput.addEventListener(\"keydown\", (e) => {\n    const resultsVisible = dom.searchResults.style.display === \"block\";\n\n    if (e.key === \"Escape\") {\n      dom.searchInput.value = \"\";\n      dom.searchClear.style.display = \"none\";\n      dom.searchResults.style.display = \"none\";\n      dom.searchResults.innerHTML = \"\";\n      dom.searchInput.blur();\n    } else if (e.key === \"ArrowDown\" && resultsVisible) {\n      e.preventDefault();\n      updateSelectedResult(\"down\");\n    } else if (e.key === \"ArrowUp\" && resultsVisible) {\n      e.preventDefault();\n      updateSelectedResult(\"up\");\n    } else if (e.key === \"Enter\" && resultsVisible) {\n      e.preventDefault();\n      const results = searchItems(dom.searchInput.value);\n      if (state.selectedResultIndex >= 0 && state.selectedResultIndex < results.length) {\n        handleResultSelection(results[state.selectedResultIndex]);\n      } else if (results.length > 0) {\n        handleResultSelection(results[0]);\n      }\n    }\n  });\n\n  dom.searchClear.addEventListener(\"click\", () => {\n    dom.searchInput.value = \"\";\n    dom.searchClear.style.display = \"none\";\n    dom.searchResults.style.display = \"none\";\n    dom.searchResults.innerHTML = \"\";\n    dom.searchInput.focus();\n  });\n\n  // Close Search Results When Clicking Outside\n  document.addEventListener(\"click\", (e) => {\n    if (!dom.searchInput.contains(e.target) &&\n        !dom.searchResults.contains(e.target) &&\n        !dom.searchClear.contains(e.target)) {\n      if (dom.searchResults.style.display === \"block\") {\n        dom.searchResults.style.display = \"none\";\n      }\n    }\n  });\n}\n\n/**\n * Initialize search event listeners\n * Call this from app.js after all modules are loaded\n */\nexport function initSearchEventListeners() {\n  // Listen for search index rebuild requests\n  window.addEventListener('searchIndexRebuildNeeded', () => {\n    console.log('[Search] Received searchIndexRebuildNeeded event');\n    rebuildSearchIndex();\n  });\n  \n  // Listen for sidebar render requests (to rebuild search index after)\n  window.addEventListener('sidebarRenderNeeded', (event) => {\n    const { folderNode } = event.detail;\n    console.log('[Search] Received sidebarRenderNeeded event');\n    // Import and call renderSidebar dynamically to avoid circular dependency at module load time\n    import('./navigation.js').then(nav => {\n      nav.renderSidebar(folderNode);\n    });\n  });\n  \n  console.log('[Search] Event listeners initialized');\n}","/**\n * Detects notch position in landscape mode and applies appropriate CSS class\n */\n\nexport function initSafeAreaDetector() {\n  /**\n   * Wait for layout stabilization using requestAnimationFrame\n   * @param {number} frames - Number of frames to wait (1 frame ≈ 16.67ms at 60fps)\n   * @returns {Promise<void>}\n   */\n  function waitForLayout(frames = 1) {\n    return new Promise(resolve => {\n      let count = 0;\n      function tick() {\n        count++;\n        if (count >= frames) {\n          resolve();\n        } else {\n          requestAnimationFrame(tick);\n        }\n      }\n      requestAnimationFrame(tick);\n    });\n  }\n\n  function detectNotchPosition() {\n    // Only run in landscape mode\n    const isLandscape = window.matchMedia('(max-height: 600px) and (orientation: landscape)').matches;\n    \n    if (!isLandscape) {\n      document.documentElement.removeAttribute('data-notch-side');\n      console.log('[SafeArea] Not in landscape mode');\n      return;\n    }\n\n    // Method 1: Use screen.orientation.angle\n    // 90 = notch on left, 270/-90 = notch on right\n    let angle = 0;\n    \n    if (window.screen && window.screen.orientation) {\n      angle = window.screen.orientation.angle;\n    } else if (window.orientation !== undefined) {\n      angle = window.orientation;\n    }\n    \n    console.log('[SafeArea] Orientation angle:', angle);\n    \n    // Determine notch side based on angle\n    // Most devices: 90° = rotated left (notch on left), -90°/270° = rotated right (notch on right)\n    if (angle === 90) {\n      document.documentElement.setAttribute('data-notch-side', 'left');\n      console.log('[SafeArea] Angle 90° - Notch on LEFT');\n    } else if (angle === -90 || angle === 270) {\n      document.documentElement.setAttribute('data-notch-side', 'right');\n      console.log('[SafeArea] Angle -90°/270° - Notch on RIGHT');\n    } else {\n      // Fallback: Try measuring safe areas\n      console.log('[SafeArea] Unknown angle, measuring safe areas...');\n      measureSafeAreas();\n    }\n  }\n\n  function measureSafeAreas() {\n    // Use getComputedStyle on root element with CSS variables\n    const root = document.documentElement;\n    \n    // Set CSS custom properties to read env() values\n    root.style.setProperty('--test-safe-left', 'env(safe-area-inset-left, 0px)');\n    root.style.setProperty('--test-safe-right', 'env(safe-area-inset-right, 0px)');\n    \n    const computedStyle = getComputedStyle(root);\n    const leftValue = computedStyle.getPropertyValue('--test-safe-left').trim();\n    const rightValue = computedStyle.getPropertyValue('--test-safe-right').trim();\n    \n    console.log('[SafeArea] Computed left:', leftValue, 'right:', rightValue);\n    \n    // Parse pixel values\n    const leftPx = parseFloat(leftValue) || 0;\n    const rightPx = parseFloat(rightValue) || 0;\n    \n    console.log('[SafeArea] Parsed left:', leftPx, 'right:', rightPx);\n    \n    if (leftPx > 20) {\n      document.documentElement.setAttribute('data-notch-side', 'left');\n      console.log('[SafeArea] Measured - Notch on LEFT');\n    } else if (rightPx > 20) {\n      document.documentElement.setAttribute('data-notch-side', 'right');\n      console.log('[SafeArea] Measured - Notch on RIGHT');\n    } else {\n      document.documentElement.setAttribute('data-notch-side', 'none');\n      console.log('[SafeArea] Measured - No notch detected');\n    }\n    \n    // Clean up\n    root.style.removeProperty('--test-safe-left');\n    root.style.removeProperty('--test-safe-right');\n  }\n\n  // Initial detection\n  waitForLayout(12).then(detectNotchPosition);\n\n  // Re-detect on orientation change\n  if (window.screen && window.screen.orientation) {\n    window.screen.orientation.addEventListener('change', () => {\n      console.log('[SafeArea] Screen orientation changed');\n      waitForLayout(18).then(detectNotchPosition);\n    });\n  }\n\n  // Fallback: orientationchange event\n  window.addEventListener('orientationchange', () => {\n    console.log('[SafeArea] Orientation change event fired');\n    waitForLayout(18).then(detectNotchPosition);\n  });\n\n  // Backup: resize event\n  let resizeAbortController = null;\n  window.addEventListener('resize', async () => {\n    // Cancel previous resize detection\n    if (resizeAbortController) {\n      resizeAbortController.abort();\n    }\n    \n    resizeAbortController = new AbortController();\n    const signal = resizeAbortController.signal;\n    \n    try {\n      // Wait ~250ms (15 frames at 60fps)\n      await Promise.race([\n        waitForLayout(15),\n        new Promise((_, reject) => {\n          signal.addEventListener('abort', () => reject(new Error('aborted')));\n        })\n      ]);\n      \n      if (!signal.aborted) {\n        console.log('[SafeArea] Resize detected, checking orientation');\n        detectNotchPosition();\n      }\n    } catch (err) {\n      // Resize was cancelled by newer event\n    }\n  });\n}\n","/**\n * PWA Detection and Service Worker Registration Utility\n * \n * CRITICAL: Only registers service worker when running as installed PWA\n * Specifically designed for iOS Safari PWA detection\n * \n * Includes debug logging for troubleshooting\n */\n\n/**\n * Detect if app is running as installed PWA\n * @returns {boolean} True if running as PWA\n */\nexport function isPWA() {\n  // Method 1: iOS Safari PWA detection\n  if (window.navigator.standalone === true) {\n    console.log('[PWA] Detected: iOS standalone mode');\n    return true;\n  }\n\n  // Method 2: Standard display-mode detection\n  if (window.matchMedia('(display-mode: standalone)').matches) {\n    console.log('[PWA] Detected: display-mode standalone');\n    return true;\n  }\n\n  // Method 3: Fullscreen mode (Android)\n  if (window.matchMedia('(display-mode: fullscreen)').matches) {\n    console.log('[PWA] Detected: display-mode fullscreen');\n    return true;\n  }\n\n  // Method 4: Minimal UI mode\n  if (window.matchMedia('(display-mode: minimal-ui)').matches) {\n    console.log('[PWA] Detected: display-mode minimal-ui');\n    return true;\n  }\n\n  console.log('[PWA] Not detected: Running in browser');\n  return false;\n}\n\n/**\n * Get PWA display mode\n * @returns {string} Display mode\n */\nexport function getPWADisplayMode() {\n  if (window.navigator.standalone === true) {\n    return 'standalone';\n  }\n  if (window.matchMedia('(display-mode: standalone)').matches) {\n    return 'standalone';\n  }\n  if (window.matchMedia('(display-mode: fullscreen)').matches) {\n    return 'fullscreen';\n  }\n  if (window.matchMedia('(display-mode: minimal-ui)').matches) {\n    return 'minimal-ui';\n  }\n  return 'browser';\n}\n\n/**\n * Show progress indicator during service worker installation\n */\nfunction showCacheProgress() {\n  const overlay = document.createElement('div');\n  overlay.id = 'pwa-cache-overlay';\n  overlay.style.cssText = `\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(31, 31, 31, 0.95);\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    z-index: 10000;\n    font-family: 'Uni Sans', sans-serif;\n  `;\n\n  overlay.innerHTML = `\n    <div style=\"text-align: center; max-width: 80%; color: #ffffff;\">\n      <div style=\"font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600;\">\n        ⚡ Preparing Full Offline Mode\n      </div>\n      <div style=\"font-size: 0.9rem; margin-bottom: 2rem; color: #cccccc;\">\n        Caching ALL assets for complete offline access...<br>\n        This may take 30-60 seconds on first install\n      </div>\n      <div style=\"width: 100%; max-width: 300px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;\">\n        <div id=\"pwa-progress-bar\" style=\"width: 0%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); transition: width 0.3s ease;\"></div>\n      </div>\n      <div id=\"pwa-progress-text\" style=\"margin-top: 1rem; font-size: 0.8rem; color: #999;\">\n        0%\n      </div>\n      <div id=\"pwa-progress-detail\" style=\"margin-top: 0.5rem; font-size: 0.7rem; color: #666; min-height: 1rem;\">\n        Starting...\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n  return overlay;\n}\n\n/**\n * Update progress bar\n */\nfunction updateProgress(progress, current, total, url) {\n  const progressBar = document.getElementById('pwa-progress-bar');\n  const progressText = document.getElementById('pwa-progress-text');\n  const progressDetail = document.getElementById('pwa-progress-detail');\n\n  if (progressBar) {\n    progressBar.style.width = progress + '%';\n  }\n  if (progressText) {\n    progressText.textContent = `${progress}% (${current}/${total})`;\n  }\n  if (progressDetail && url) {\n    const fileName = url.split('/').pop() || url;\n    const shortName = fileName.length > 40 ? fileName.substring(0, 37) + '...' : fileName;\n    progressDetail.textContent = shortName;\n  }\n}\n\n/**\n * Remove progress overlay\n */\nfunction hideProgress() {\n  const overlay = document.getElementById('pwa-cache-overlay');\n  if (overlay) {\n    overlay.style.opacity = '0';\n    overlay.style.transition = 'opacity 0.5s ease';\n    setTimeout(() => overlay.remove(), 500);\n  }\n}\n\n/**\n * Register service worker (only if PWA)\n * @returns {Promise<boolean>} True if registered successfully\n */\nexport async function registerServiceWorker() {\n  // Debug logging\n  console.log('[PWA Debug] === Service Worker Registration Debug ===');\n  console.log('[PWA Debug] Protocol:', window.location.protocol);\n  console.log('[PWA Debug] Hostname:', window.location.hostname);\n  console.log('[PWA Debug] Port:', window.location.port);\n  console.log('[PWA Debug] Secure context:', window.isSecureContext);\n  console.log('[PWA Debug] Service worker available:', 'serviceWorker' in navigator);\n  console.log('[PWA Debug] Navigator standalone:', window.navigator.standalone);\n  console.log('[PWA Debug] Display mode:', getPWADisplayMode());\n  console.log('[PWA Debug] isPWA():', isPWA());\n\n  // CRITICAL: Only register if running as PWA\n  if (!isPWA()) {\n    console.log('[PWA] Service worker NOT registered: Not running as PWA');\n    return false;\n  }\n\n  if (!('serviceWorker' in navigator)) {\n    console.warn('[PWA] Service worker not supported in this browser');\n    console.warn('[PWA] Possible causes:');\n    console.warn('[PWA]   - Not HTTPS (requires HTTPS or localhost)');\n    console.warn('[PWA]   - Browser too old');\n    console.warn('[PWA]   - Private browsing mode');\n    return false;\n  }\n\n  if (!window.isSecureContext) {\n    console.error('[PWA] Not a secure context (HTTPS required)');\n    console.error('[PWA] Current protocol:', window.location.protocol);\n    console.error('[PWA] Service worker registration blocked');\n    return false;\n  }\n\n  console.log('[PWA] Registering service worker...');\n\n  try {\n    // Check if this is first installation\n    const registrations = await navigator.serviceWorker.getRegistrations();\n    const isFirstInstall = registrations.length === 0;\n\n    console.log('[PWA Debug] Existing registrations:', registrations.length);\n    console.log('[PWA] First install:', isFirstInstall);\n\n    let progressOverlay = null;\n    if (isFirstInstall) {\n      progressOverlay = showCacheProgress();\n      console.log('[PWA] First install - showing progress overlay');\n      console.log('[PWA] ⏳ This will take 30-60 seconds to cache everything');\n    }\n\n    // Listen for progress messages\n    navigator.serviceWorker.addEventListener('message', (event) => {\n      if (event.data && event.data.type === 'CACHE_PROGRESS') {\n        updateProgress(\n          event.data.progress,\n          event.data.current,\n          event.data.total,\n          event.data.url\n        );\n      }\n\n      if (event.data && event.data.type === 'CACHE_COMPLETE') {\n        console.log('[PWA] ✅ Cache complete!');\n        console.log('[PWA] Total:', event.data.totalAssets);\n        console.log('[PWA] Cached:', event.data.cachedAssets);\n        if (event.data.failedAssets > 0) {\n          console.warn('[PWA] Failed:', event.data.failedAssets);\n        }\n        setTimeout(() => hideProgress(), 1000);\n      }\n    });\n\n    // Register service worker\n    const registration = await navigator.serviceWorker.register('./service-worker.js', {\n      scope: './'\n    });\n\n    console.log('[PWA] Service worker registered');\n    console.log('[PWA Debug] Scope:', registration.scope);\n    console.log('[PWA Debug] Active:', !!registration.active);\n    console.log('[PWA Debug] Installing:', !!registration.installing);\n    console.log('[PWA Debug] Waiting:', !!registration.waiting);\n\n    // Request persistent storage\n    if (navigator.storage && navigator.storage.persist) {\n      const isPersisted = await navigator.storage.persist();\n      if (isPersisted) {\n        console.log('[PWA] ✅ Persistent storage granted');\n      } else {\n        console.warn('[PWA] ⚠️  Persistent storage denied (cache may be evicted)');\n      }\n\n      // Check storage estimate\n      if (navigator.storage.estimate) {\n        const estimate = await navigator.storage.estimate();\n        console.log('[PWA Debug] Storage usage:', Math.round(estimate.usage / 1024 / 1024) + ' MB');\n        console.log('[PWA Debug] Storage quota:', Math.round(estimate.quota / 1024 / 1024) + ' MB');\n      }\n    }\n\n    // Handle updates\n    registration.addEventListener('updatefound', () => {\n      const newWorker = registration.installing;\n      console.log('[PWA] New service worker found, installing...');\n\n      newWorker.addEventListener('statechange', () => {\n        console.log('[PWA Debug] Worker state:', newWorker.state);\n        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n          console.log('[PWA] New service worker installed, update available');\n        }\n      });\n    });\n\n    if (!isFirstInstall && progressOverlay) {\n      hideProgress();\n    }\n\n    return true;\n  } catch (error) {\n    console.error('[PWA] Service worker registration failed:', error);\n    console.error('[PWA Debug] Error name:', error.name);\n    console.error('[PWA Debug] Error message:', error.message);\n    hideProgress();\n    return false;\n  }\n}\n\n/**\n * Check if app is ready for offline use\n * @returns {Promise<boolean>}\n */\nexport async function isOfflineReady() {\n  if (!('serviceWorker' in navigator)) {\n    return false;\n  }\n\n  const registration = await navigator.serviceWorker.getRegistration();\n  if (!registration || !registration.active) {\n    return false;\n  }\n\n  const cacheNames = await caches.keys();\n  return cacheNames.some(name => name.startsWith('unstablon-offline-'));\n}\n\nconsole.log('[PWA] PWA detector utility loaded');\n","/**\n * Main application entry point\n * Orchestrates all modules and handles initialization\n */\n\nimport { dom, state, initDOMRefs } from './core/state.js';\nimport { notifyModuleReady, isDesktopOrTablet, isMediumViewport } from './core/utils.js';\nimport { initTheme } from './modules/theme.js';\nimport { initSidebar, toggleSidebar } from './modules/sidebar.js';\nimport { renderSidebar } from './modules/navigation.js';\nimport { openNode } from './modules/content-loader.js';\nimport { preloadFolderModules, getInitialFolder } from './modules/preloader.js';\nimport { rebuildSearchIndex } from './modules/search.js'; \nimport { initSafeAreaDetector } from './modules/safe-area-detector.js';\nimport { initKeyboardShortcuts } from './modules/keyboard-shortcuts.js'; \nimport * as MathJaxUtil from './loader/mathjax-loader.js';\nimport { isPWA, getPWADisplayMode, registerServiceWorker } from './modules/pwa.js';\n\n(function () {\n  \"use strict\";\n\n  console.log('[App] Initializing application...');\n\n  // Conditionally load manifest to prevent Opera GX icon fetching bug\n  function loadManifestConditionally() {\n    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n    const isAlreadyPWA = isPWA();\n    \n    if (isMobile || isAlreadyPWA) {\n      const link = document.createElement('link');\n      link.rel = 'manifest';\n      link.href = './manifest.json';\n      document.head.appendChild(link);\n      console.log('[App] Manifest loaded (mobile or PWA mode)');\n    } else {\n      console.log('[App] Manifest skipped (desktop browser mode - prevents icon spam)');\n    }\n  }\n\n  // Load manifest conditionally FIRST\n  loadManifestConditionally();\n\n  // PWA detection and service worker registration\n  if (isPWA()) {\n    console.log('[App] Running as PWA in', getPWADisplayMode(), 'mode');\n    registerServiceWorker().then(registered => {\n      if (registered) {\n        console.log('[App] PWA offline mode enabled');\n      }\n    }).catch(error => {\n      console.error('[App] PWA initialization failed:', error);\n    });\n  } else {\n    console.log('[App] Running in browser mode (service worker disabled)');\n  }\n\n  // Register global module ready notification\n  window.__moduleReady = notifyModuleReady;\n\n  // Expose MathJax utility globally for non-module scripts (e.g., preloaded calculators)\n  window.MathJaxUtility = MathJaxUtil;\n  console.log('[App] MathJax utility exposed globally');\n\n  /**\n   * Initialize application on page load\n   */\n  window.addEventListener(\"load\", async () => {\n    console.log('[App] Page loaded, initializing DOM references');\n\n    // Initialize DOM references first\n    initDOMRefs();\n    initSafeAreaDetector();\n\n    // Initialize all modules (await theme to ensure assets are preloaded)\n    await initTheme();\n    initSidebar();\n    initKeyboardShortcuts(); \n\n    console.log('[App] Fetching navigation tree');\n\n    // Load navigation tree from static JSON\n    fetch(\"./javascript/tree.json\")\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(\"Failed to load navigation tree\");\n        }\n        return res.json();\n      })\n      .then(async (tree) => { \n        console.log('[App] Navigation tree loaded');\n        state.navigationTree = tree;\n\n        const initialFolder = getInitialFolder(state.navigationTree);\n\n        await renderSidebar(initialFolder); \n        preloadFolderModules(initialFolder);\n\n        // Build search index after tree is loaded\n        rebuildSearchIndex();\n\n        const { initPreloader } = await import('./modules/preloader.js');\n        const { initSearchEventListeners } = await import('./modules/search.js');\n        \n        initPreloader();\n        initSearchEventListeners();\n        \n        console.log('[App] Event-driven module communication initialized');\n\n        // Default node: first module/page/document directly under that folder\n        let defaultNode = null;\n        if (initialFolder.children) {\n          defaultNode =\n            initialFolder.children.find(\n              (c) =>\n                c.type === \"module\" ||\n                c.type === \"page\" ||\n                c.type === \"document\"\n            ) || null;\n        }\n\n        if (defaultNode) {\n          const defaultBtn = dom.sidebarNav.querySelector(\n            '.nav-item[data-type=\"' +\n              defaultNode.type +\n              '\"][data-id=\"' +\n              defaultNode.id +\n              '\"]'\n          );\n          if (defaultBtn) {\n            defaultBtn.classList.add(\"active\");\n          }\n          openNode(defaultNode);\n        } else {\n          dom.card.classList.remove(\"preload\");\n          dom.card.classList.add(\"loaded\");\n        }\n      })\n      .catch((err) => {\n        console.error('[App] Failed to load navigation tree:', err);\n        dom.card.classList.remove(\"preload\");\n        dom.card.classList.add(\"loaded\");\n      });\n  });\n\n  /**\n   * Handle window resize\n   */\n  window.addEventListener(\"resize\", () => {\n    if (!isDesktopOrTablet()) {\n      dom.sidebar.style.width = \"\";\n    } else {\n      if (dom.sidebar.getAttribute(\"data-open\") === \"true\") {\n        dom.sidebar.style.width = state.baseSidebarWidth + \"px\";\n      } else {\n        dom.sidebar.style.width = \"\";\n      }\n    }\n  });\n\n  /**\n   * Auto-collapse sidebar when clicking on main content (for medium viewports/tablets)\n   */\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    initDOMRefs();\n\n    if (dom.card) {\n      dom.card.addEventListener(\"click\", () => {\n        if (isMediumViewport() && dom.sidebar.getAttribute(\"data-open\") === \"true\") {\n          toggleSidebar();\n        }\n      });\n    }\n\n    if (dom.mainContent) {\n      dom.mainContent.addEventListener(\"click\", (e) => {\n        if (e.target === dom.mainContent || e.target.classList.contains(\"page-root\")) {\n          if (isMediumViewport() && dom.sidebar.getAttribute(\"data-open\") === \"true\") {\n            toggleSidebar();\n          }\n        }\n      });\n    }\n  });\n\n  console.log('[App] Initialization complete');\n})();\n","// FILE: javascript/modules/keyboard-shortcuts.js | NEW FILE\n\n/**\n * Centralized keyboard shortcut management\n * Handles all global keyboard shortcuts for the application\n */\n\nimport { dom } from '../core/state.js';\nimport { toggleSidebar, isSidebarContentInitialized } from './sidebar.js';\n\n/**\n * Initialize all keyboard shortcuts\n * Call early in app.js to register shortcuts before lazy-loaded modules\n */\nexport function initKeyboardShortcuts() {\n  console.log('[Shortcuts] Initializing keyboard shortcuts');\n\n  // Ctrl+K or Cmd+K: Focus Search\n  document.addEventListener(\"keydown\", async (e) => {\n    if ((e.ctrlKey || e.metaKey) && e.key === \"k\") {\n      e.preventDefault();\n      \n      // Open sidebar if closed (triggers lazy loading of search UI)\n      if (dom.sidebar.getAttribute(\"data-open\") !== \"true\") {\n        await toggleSidebar();\n      }\n      \n      // Wait for search UI to be initialized (if first time)\n      // Give time for lazy loading to complete\n      await new Promise(resolve => {\n        if (isSidebarContentInitialized()) {\n          resolve();\n        } else {\n          // Wait for next frame after sidebar opens\n          requestAnimationFrame(() => {\n            requestAnimationFrame(resolve);\n          });\n        }\n      });\n      \n      // Focus search input\n      if (dom.searchInput) {\n        dom.searchInput.focus();\n        console.log('[Shortcuts] Search focused via Ctrl+K');\n      }\n    }\n  });\n\n  console.log('[Shortcuts] Registered: Ctrl+K (Focus Search)');\n}\n\n// Future shortcuts can be added here:\n// registerShortcut('Ctrl+N', 'New note', () => { ... });\n// registerShortcut('Ctrl+/', 'Toggle help', () => { ... });"],"names":["state","activeInstance","activeNode","baseSidebarWidth","hoverSidebarWidth","hoverNeeded","searchIndex","selectedResultIndex","moduleDisplayNames","preloadedModules","Set","navigationTree","currentFolder","loadedScripts","moduleFactories","Map","moduleReadyCallbacks","folderWidthCache","themeController","getTheme","document","documentElement","getAttribute","subscribe","fn","addEventListener","removeEventListener","dom","htmlEl","sidebar","sidebarToggle","sidebarNav","sidebarBreadcrumb","card","themeToggleBtn","themeIcon","searchInput","searchClear","searchResults","mainContent","initDOMRefs","getElementById","querySelector","findNodeByPath","node","path","children","child","found","findLeafById","id","type","isDesktopOrTablet","window","innerWidth","isMediumViewport","scriptUrlFromFile","filePath","factoryNameFromId","charAt","toUpperCase","slice","notifyModuleReady","factoryName","callbacks","get","factory","forEach","cb","delete","imageCache","animationInProgress","setThemeMetaColor","theme","themeColorMeta","setAttribute","replaceWithCachedImage","targetImg","cacheKey","fallbackSrc","cachedImg","complete","naturalWidth","src","newImg","cloneNode","Array","from","attributes","attr","name","value","className","style","pointerEvents","userSelect","parentNode","replaceChild","console","warn","cleanupAnimation","element","handler","willChange","once","toggleTheme","next","textContent","landscapeThemeIcon","headerLogo","headerBanner","headerTagline","landscapeLogo","classList","remove","offsetWidth","animation","bannerKey","bannerFallback","requestAnimationFrame","add","setTimeout","updateThemeAssets","event","CustomEvent","detail","dispatchEvent","onThemeChange","async","initTheme","loadPromises","key","map","Promise","resolve","reject","img","Image","onload","onerror","all","then","preloadThemeImages","landscapeThemeToggle","initialTheme","shadowRoots","platformResources","registerPlatformResource","config","url","content","integrity","error","has","resource","loaded","set","markResourceLoaded","resourceId","shadowRoot","injectResourceIntoShadowRoot","instanceId","link","createElement","rel","href","dataset","platformResource","crossOrigin","firstChild","insertBefore","appendChild","fontStyle","loadedResources","fontAwesomeLoadPromise","loadFontAwesome","faURL","crossorigin","Error","head","loadCSS","catch","getTypeIcon","isCurrentlyHovering","sidebarContentInitialized","isLandscapeMode","matchMedia","matches","applySidebarWidth","width","toggleSidebar","searchContainer","innerHTML","initSearch","initSidebarSearch","String","landscapeToggle","currentWidth","getBoundingClientRect","e","propertyName","clearSidebarActive","querySelectorAll","b","handleSidebarMouseEnter","handleSidebarMouseLeave","related","relatedTarget","contains","initSidebar","isSidebarContentInitialized","mathJaxLoaded","mathJaxLoadingPromise","loadMathJax","MathJax","tex","inlineMath","displayMath","svg","fontCache","options","skipHtmlTags","startup","ready","defaultReady","script","typesetMath","container","typesetPromise","dynamicRender","rerenderPromises","html","test","push","length","messageTunnel","constructor","this","subscribers","messageLog","send","fromInstanceId","toInstanceId","message","timestamp","Date","now","to","size","envelope","callback","broadcast","unsubscribe","createInstanceAPI","onMessage","getMessageLog","clearMessageLog","instanceManager","instances","compartments","metadata","hierarchy","register","instance","moduleId","parentId","cardId","rootElement","createdAt","destroy","_getDescendants","reverse","data","destroyCompartment","descendants","childId","generateInstanceId","parentInstanceId","basePath","index","candidateId","registerCompartment","compartment","getCompartment","routeMessage","getInstanceById","clear","createShadowRoot","attachShadow","mode","ShadowRoot","registerShadowRoot","styleContainer","variablesLink","modulesLink","baseStyles","injectThemeStyles","contentRoot","getFactoryForModule","scriptSrc","file","moduleCode","response","fetch","ok","status","statusText","text","fetchModuleCode","evaluate","globalThis","Object","keys","loadModule","done","normalized","replace","startsWith","getModuleLayer","sandboxedDocument","MAX_NODES","nodeCount","warningSent","Proxy","target","prop","bind","tagName","Math","round","call","createTextNode","createDocumentFragment","createComment","createSandboxedDocument","sandboxedWindow","eventListeners","includes","Event","eventName","isInstanceEvent","isSafeGlobal","listeners","findIndex","l","splice","__moduleReady","createSandboxedWindow","tunnel","compartmentGlobals","JSON","Number","Boolean","RegExp","TypeError","RangeError","SyntaxError","parseInt","parseFloat","isNaN","isFinite","cancelAnimationFrame","harden","eval","undefined","Function","setInterval","XMLHttpRequest","MutationObserver","IntersectionObserver","ResizeObserver","buildCompartmentGlobals","globalOverrides","Compartment","createSecureCompartment","root","__options","err","classes","elementContainsFontAwesome","autoRender","openNode","clearActiveInstance","res","loadPage","md","inner","pre","loadDocument","iconsLoaded","renderBreadcrumb","segments","split","segment","isLast","join","part","navigateToFolder","sep","folderNode","renderSidebar","sidebarModule","ensureIconsLoaded","items","parentPath","upItem","btn","padStart","label","title","calculateFolderWidth","labelTexts","tempContainer","position","left","top","visibility","body","maxLabelWidth","fontSize","lineHeight","whiteSpace","display","removeChild","totalNeeded","navIndexWidth","ceil","measureLabelsWidth","filter","preloadFolderModules","folderPath","cachedWidth","modulesToPreload","preloadNext","mod","requestIdleCallback","displayName","code","infoMatch","match","factoryMatch","trim","extractDisplayNameFromCode","getInitialFolder","tree","buildSearchIndex","pathArray","currentPath","displayPath","searchText","toLowerCase","tags","newPath","rebuildSearchIndex","searchItems","query","trimmedQuery","results","item","score","lowerQuery","lowerText","words","word","scoreMatch","sort","a","aName","bName","localeCompare","handleResultSelection","navItem","updateSelectedResult","direction","scrollIntoView","block","searchDebounceTimer","clearTimeout","highlightedName","indexOf","substring","highlightMatch","el","renderSearchResults","resultsVisible","blur","preventDefault","focus","navigation","nav","initSafeAreaDetector","waitForLayout","frames","count","tick","detectNotchPosition","removeAttribute","angle","screen","orientation","setProperty","computedStyle","getComputedStyle","leftValue","getPropertyValue","rightValue","leftPx","rightPx","removeProperty","measureSafeAreas","resizeAbortController","abort","AbortController","signal","race","_","aborted","isPWA","navigator","standalone","hideProgress","overlay","opacity","transition","registerServiceWorker","isSecureContext","location","protocol","isFirstInstall","serviceWorker","getRegistrations","progressOverlay","cssText","showCacheProgress","progress","current","total","progressBar","progressText","progressDetail","fileName","pop","shortName","updateProgress","failedAssets","registration","scope","storage","persist","estimate","newWorker","installing","controller","isMobile","userAgent","isAlreadyPWA","loadManifestConditionally","registered","MathJaxUtility","MathJaxUtil","ctrlKey","metaKey","json","initialFolder","initPreloader","preloader","initSearchEventListeners","search","defaultNode","find","c","defaultBtn"],"mappings":"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"}